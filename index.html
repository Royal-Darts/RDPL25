<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Royal Darts Premier League 2025</title>
  <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/174/174855.png" />
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f8f8f8;
      margin: 0; padding: 0;
    }
    header {
      background: #121212;
      color: #fff;
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 0.75rem 1rem;
    }
    header img {
      height: 60px;
    }
    nav {
      background: #ececec;
      display: flex;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      overflow-x: auto;
    }
    nav button {
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 0.75rem 1rem;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.2s;
    }
    nav button.active {
      background: #121212;
      color: #fff;
      border-color: #000;
    }
    main {
      padding: 1rem;
    }
    .section { display: none; }
    .section.active { display: block; }
    table {
      border-collapse: collapse;
      width: 100%;
      background: #fff;
      margin-bottom: 2rem;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }
    th, td {
      border: 1px solid #e5e5e5;
      padding: 0.5rem 0.6rem;
      text-align: left;
    }
    th {
      background: #ececec;
      font-weight: bold;
    }
    /* Highlights grid */
    .highlights-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(210px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }
    .highlight-card {
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      padding: 1.25rem;
      text-align: center;
      font-size: 1.12rem;
    }
    .highlight-card strong {
      display: block;
      font-size: 1.08rem;
      margin-bottom: 0.5rem;
      color: #4040a1;
    }
    footer {
      background: #121212;
      color: #ccc;
      padding: 1rem;
      text-align: center;
    }
    .footer-icons {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 1.5rem;
      margin-bottom: 0.4rem;
    }
    .footer-icons img {
      width: 32px;
      height: 32px;
      object-fit: contain;
      margin: 0 4px;
      vertical-align: middle;
      background: #fff;
      border-radius: 8px;
      border: 1px solid #eee;
      padding: 2px;
      transition: box-shadow 0.18s;
    }
    .footer-icons img:hover {
      box-shadow: 0 0 6px #0055ff55;
    }
    .footer-suca {
      font-size: 0.96rem;
      color: #e0e0e0;
      margin-top: 2px;
    }
  </style>
</head>
<body>
  <header>
    <img src="logo.png" alt="Tournament Logo" />
    <h1>Royal Darts Premier League 2025</h1>
  </header>
  <nav>
    <button class="tab-button active" onclick="showTab('fixtures')">Fixtures</button>
    <button class="tab-button" onclick="showTab('results')">Results</button>
    <button class="tab-button" onclick="showTab('standings')">Standings</button>
    <button class="tab-button" onclick="showTab('squads')">Squads</button>
    <button class="tab-button" onclick="showTab('stats')">Stats</button>
  </nav>
  <main>
    <section id="fixtures" class="section active"><div id="fixturesTableContainer"></div></section>
    <section id="results" class="section"><div id="resultsContainer"></div></section>
    <section id="standings" class="section">
      <div id="standingsGroupA"></div>
      <div id="standingsGroupB"></div>
      <div class="standings-key">
        <p><strong>EF</strong> = Events For, <strong>EA</strong> = Events Against, <strong>ED</strong> = Event Difference</p>
      </div>
    </section>
    <section id="squads" class="section"><div id="squadsContainer">Loading...</div></section>
    <section id="stats" class="section">
      <div id="highlights"></div>
      <div id="stats-table"></div>
    </section>
  </main>
  <footer>
    <div class="footer-icons">
      <a href="https://n01darts.com/n01/tournament/comp.php?id=t_NI0o_4352&tab=live" target="_blank">
        <img src="https://n01darts.com/favicon.ico" alt="Nakka" title="Watch Live on Nakka" />
      </a>
      <a href="https://www.instagram.com/royaldarts_rcgc" target="_blank">
        <img src="https://cdn-icons-png.flaticon.com/512/174/174855.png" alt="Instagram" title="Follow us on Instagram" />
      </a>
    </div>
    <div class="footer-suca">Built by SUCA Analytics</div>
  </footer>
  <script>
    // ----- TEAM LOGOS MAP (unchanged) -----
    const TEAM_LOGOS = {
      // ... your team logos ...
    };

    const API_URL = 'https://script.google.com/macros/s/AKfycby6BCE5cyBaxpz-Jt-TeRH6k5Jeq-vqelr8S7rt32e7wFjBzEvuBrYi4yPaEBz2Kari/exec';

    function showTab(tabId) {
      document.querySelectorAll('.section').forEach(sec => sec.classList.remove('active'));
      document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
      document.getElementById(tabId).classList.add('active');
      event.target.classList.add('active');
    }

    let fixturesCache = [];
    let statsCache = [];

    async function loadData() {
      try {
        const res = await fetch(API_URL);
        const data = await res.json();

        // Only use non-empty data columns for stats
        fixturesCache = data.Fixtures || [];
        renderFixtures(data.Fixtures);
        renderResults(data.Results, fixturesCache);
        renderStandings(data.Standings);
        renderSquads(data.Squads);

        // STATS: drop empty/hidden columns (A, C) and any row with no player name
        statsCache = (data.Stats || []).map(row => {
          const { Player, Team, "Match Played":matchPlayed, "Sets Played":setsPlayed, "Sets Won":setsWon,
            "Legs Played":legsPlayed, "Legs Diff":legsDiff, "Legs Won":legsWon,
            "100+":ton100, "140+":ton140, "170+":ton170, "180's":ton180,
            "High Finish":highFinish, "100+ Finishes":finishes100,
            "Best Leg":bestLeg, "Win Rate (Sets)":wrSets, "Win Rate (Legs)":wrLegs,
            "3 Dart Avg":d3, "1 Dart Avg":d1, "First 9 Avg":f9,
            Keep, Break, "Second Legs":secondLegs, "Break Legs":breakLegs,
            "Total Score":totalScore, "Total Darts":totalDarts, Group
          } = row;
          return Player ? {
            Player, Team, "Match Played":matchPlayed, "Sets Played":setsPlayed, "Sets Won":setsWon,
            "Legs Played":legsPlayed, "Legs Diff":legsDiff, "Legs Won":legsWon,
            "100+":ton100, "140+":ton140, "170+":ton170, "180's":ton180,
            "High Finish":highFinish, "100+ Finishes":finishes100,
            "Best Leg":bestLeg, "Win Rate (Sets)":wrSets, "Win Rate (Legs)":wrLegs,
            "3 Dart Avg":d3, "1 Dart Avg":d1, "First 9 Avg":f9,
            Keep, Break, "Second Legs":secondLegs, "Break Legs":breakLegs,
            "Total Score":totalScore, "Total Darts":totalDarts, Group
          } : null;
        }).filter(Boolean);

        renderStats(statsCache);

      } catch (err) {
        console.error('Failed to load data:', err);
      }
    }

    // --- Highlights: Show Best 3-Dart Avg, Best First 9 Avg, Most Legs Won, Highest Finish, Best Leg (from stats only) ---
    function renderStats(stats) {
      // Highlights (min 2 matches)
      const highlightsDefs = [
        { key: "3 Dart Avg", label: "Best 3-Dart Avg", compare: (a,b) => +b["3 Dart Avg"] - +a["3 Dart Avg"], fmt: x => x },
        { key: "First 9 Avg", label: "Best First 9 Avg", compare: (a,b) => +b["First 9 Avg"] - +a["First 9 Avg"], fmt: x => x },
        { key: "Legs Won", label: "Most Legs Won", compare: (a,b) => +b["Legs Won"] - +a["Legs Won"], fmt: x => x },
        { key: "High Finish", label: "Highest Finish", compare: (a,b) => +b["High Finish"] - +a["High Finish"], fmt: x => x }
      ];
      const eligible = stats.filter(p => Number(p["Match Played"]) >= 2);

      let html = "<h2>Highlights</h2><div class='highlights-grid'>";
      highlightsDefs.forEach(def => {
        const sorted = [...eligible].sort(def.compare);
        const best = sorted[0];
        html += `<div class='highlight-card'><strong>${def.label}</strong>
                  <p>${best?.Player || "—"} (${best?.[def.key] ?? "—"})</p>
                 </div>`;
      });

      // Best Leg highlight: find player(s) with the *lowest* (fastest) Best Leg
      const bestLegs = eligible.filter(p => p["Best Leg"] && !isNaN(Number(p["Best Leg"])));
      let minBestLeg = Math.min(...bestLegs.map(p => Number(p["Best Leg"])));
      let bestLegPlayers = bestLegs.filter(p => Number(p["Best Leg"]) === minBestLeg);

      html += `<div class='highlight-card'><strong>Best Leg</strong>
        <p>${
          bestLegPlayers.length
            ? bestLegPlayers.map(p => `${p.Player} (${p["Best Leg"]})`).join("<br>")
            : "—"
        }</p></div>`;

      html += "</div>";
      document.getElementById("highlights").innerHTML = html;

      // Stats Table (skip any blank/hidden columns)
      if (stats.length) {
        const wantedHeaders = Object.keys(stats[0]).filter(
          h => h && h !== "" && h !== undefined && h !== null && !["", undefined, null].includes(h)
        );
        let table = "<table><thead><tr>" +
          wantedHeaders.map(h => `<th>${h}</th>`).join("") +
          "</tr></thead><tbody>";
        stats.forEach(row => {
          table += "<tr>" + wantedHeaders.map(h => `<td>${row[h] ?? ""}</td>`).join("") + "</tr>";
        });
        table += "</tbody></table>";
        document.getElementById("stats-table").innerHTML = table;
      } else {
        document.getElementById("stats-table").innerHTML = "<p>No player stats available.</p>";
      }
    }

    // ... Your renderFixtures, renderResults, renderStandings, renderSquads functions (unchanged) ...

    // --- LOAD ---
    loadData();
    setInterval(loadData, 60000);
  </script>
</body>
</html>
