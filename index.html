<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Royal Darts Premier League 2025</title>
  <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/174/174855.png" />
  <style>
    html,body { background:#f7f9fc; margin:0; color:#21243a; font-family: 'Segoe UI',Arial,sans-serif;}
    header { background:#181f2b; color:#fff; padding:1.2rem 1rem 0.9rem 1rem; text-align:center; min-width:0;}
    header img { max-height:52px; margin-bottom:0.25rem;}
    .hamburger {
      display: none; position: absolute; right:18px; top:18px; background:none; border:none; z-index:99;
      flex-direction:column;justify-content:center;align-items:center; width:38px;height:38px;cursor:pointer;
    }
    .hamburger span { display:block; width:27px; height:4px; background:#fff; margin:4px 0; border-radius:3px;}
    nav {
      background:#232323; border-bottom:1px solid #232323; width:100vw; position:sticky;top:0;z-index:40;
      display:flex;justify-content:center;align-items:center;transition:height 0.15s;
    }
    .nav-main { display:flex; justify-content:center; align-items:center; gap:0.2rem; flex-wrap:nowrap; }
    nav button {
      flex: 1 0 auto;
      padding:1rem 1.1rem;
      color:white;
      background:none;
      border:none;
      cursor:pointer;
      font-weight:500;
      font-size:1.1em;
      transition:background 0.13s;
      white-space:nowrap;
    }
    nav button:hover,nav button.active {background:#353535;}
    nav .tab-button { border-radius:0; }
    nav.open .nav-main { display:flex;flex-direction:column; width:100vw;}
    nav.open { position:fixed; top:0; left:0; width:100vw; height:100vh; background:#222c; z-index:999;}
    nav.open button { width:100vw;text-align:left; font-size:1.15em; padding:1.3rem 1.3rem;}
    main { max-width: 1170px; margin:auto; padding:2rem 2vw 1.5rem 2vw; }
    .section {display:none;}
    .section.active {display:block;}
    .dashboard-fixtures-list {width:100%;max-width:540px;margin:0 auto 2em auto;}
    .dashboard-fixture-row {
      background:#fff; border-radius:9px;
      box-shadow:0 1px 4px #0001; display:flex;align-items:center;justify-content:space-between;
      padding:0.55em 0.6em 0.48em 0.6em; margin-bottom:0.54em;
      gap:0.6em; font-size:1.01em;min-width:0;
    }
    .dash-fixt-time {color:#1856e7; font-weight:700; font-size:0.96em;min-width:61px;}
    .dash-fixt-team {display:flex;align-items:center;gap:0.32em; font-weight:600;min-width:0;max-width:44vw;overflow:hidden;}
    .dash-fixt-logo {width:19px;height:19px;border-radius:7px;background:#fff;border:1.2px solid #e6e6e6;object-fit:contain;}
    .dash-fixt-vs {font-size:1.05em; font-weight:700; color:#232323;}
    .show-all-btn {
      border:none;background:#ececec;color:#1856e7;padding:7px 23px;border-radius:8px;cursor:pointer;
      font-size:1em;margin:0 auto 1.2em auto;display:block;font-weight:600;transition:background 0.13s;
    }
    .show-all-btn:hover {background:#d6e6ff;}
    .standings-row {display:flex;align-items:center;justify-content:space-between;border-radius:7px;padding:6px 9px;margin-bottom:5px;}
    .cup-gold {background:#ffe083;}
    .cup-silver {background:#ececec;}
    .cup-elim {background:#ffd6d6;}
    .cup-badge {font-size:0.96em;padding:2px 7px;border-radius:6px;margin-left:5px;font-weight:700;}
    .cup-badge.gold {background:gold;color:#222;}
    .cup-badge.silver {background:silver;color:#222;}
    .cup-badge.elim {background:#ffeded;color:#666;}
    .standings-title {font-size:1.13em;font-weight:700;margin:1em 0 0.35em 0;}
    .dash-high-bar {display:flex;gap:0.6em;justify-content:center;flex-wrap:wrap;margin:1.4em 0 1.1em 0;}
    .dash-high-card {background:#fff;border-radius:10px;box-shadow:0 2px 8px #0001;min-width:110px;max-width:145px;padding:0.78em 0.3em;display:flex;flex-direction:column;align-items:center;}
    .dash-high-label {color:#18449e;font-size:0.97em;font-weight:700;}
    .dash-high-main {font-size:1.27em;font-weight:800;color:#eab403;margin:0.08em 0;}
    .dash-high-player {font-size:0.92em;text-align:center;margin-top:0.13em;}
    .dash-high-player img {width:15px;height:15px;vertical-align:middle;margin-right:5px;border-radius:4px;}
    .dash-teamday-card {background:#ebf5ff;border-radius:10px;box-shadow:0 2px 8px #3385cc11;min-width:124px;max-width:170px;padding:0.78em 0.5em;display:flex;flex-direction:column;align-items:center;}
    .dash-teamday-logo {width:25px;height:25px;border-radius:6px;margin-bottom:0.14em;}
    .dash-teamday-title {font-size:1em;font-weight:700;margin-bottom:0.13em;color:#18449e;}
    .dash-teamday-main {font-size:1.19em;font-weight:900;color:#1856e7;}
    .latestres-title {font-size:1.03em;font-weight:700;margin-bottom:0.11em;}
    .latestres-row {background:#fff;border-radius:8px;box-shadow:0 1px 6px #0001;display:flex;align-items:center;justify-content:space-between;padding:0.63em 0.8em;margin-bottom:0.38em;gap:0.5em;}
    .latestres-team {display:flex;align-items:center;gap:0.32em;}
    .latestres-logo {width:15px;height:15px;border-radius:4px;object-fit:contain;}
    .latestres-score {font-size:1em;font-weight:700;}
    .latestres-winner {background:#ffe083;padding:1px 5px;border-radius:4px;font-weight:700;margin-left:5px;}
    .dashboard-navstrip {display:flex;flex-wrap:wrap;gap:0.7em;justify-content:center;margin:2em 0 0.5em 0;}
    .dashboard-navcard {background:#fff;border-radius:8px;box-shadow:0 2px 8px #0001;padding:0.6em 1.1em;font-weight:700;color:#18449e;font-size:0.96rem;letter-spacing:0.01em;border:none;cursor:pointer;min-width: 90px;transition:background 0.14s;}
    .dashboard-navcard:hover {background:#e8eaff;}
    .footer-icons {margin-top:0.7rem;text-align:center;display:flex;justify-content:center;align-items:center;gap:1.2rem;}
    .footer-icons img {height:23px;width:23px;vertical-align:middle;border-radius:5px;background:#fff;border:1px solid #eee;box-shadow:0 1px 4px rgba(0,0,0,0.05);}
    .footer-suca {margin-top:0.5rem;text-align:center;color:#bdbdbd;font-size:0.93rem;}
    .table-scroll {overflow-x:auto;width:100%;margin-bottom:1rem;}
    table {width:100%;border-collapse:collapse;margin-bottom:1.2rem;background:#fff;border-radius:10px;box-shadow:0 2px 8px #0001;}
    th,td {padding:0.43rem 0.2rem;border:1px solid #e6e6e6;text-align:center;vertical-align:middle;font-size:0.98rem;white-space:nowrap;}
    th {background:#f7f7f7;font-weight:700;}
    .gold-row {background:#ffe083;}
    .silver-row {background:#ececec;}
    .elim-row {background:#ffd6d6;}
    .date-heading {background: #181f2b;color:#fff;font-size:0.98rem;font-weight:bold;letter-spacing:1px;padding:0.3rem 0.7rem;border-radius:6px;margin:18px 0 6px 0;display:inline-block;}
    .group-title {font-size:1.02rem;font-weight:700;margin:10px 0 5px 0;color:#21405a;}
    .squad-grid {display:grid;grid-template-columns:repeat(auto-fit,minmax(170px,1fr));gap:1.2em;}
    .squad-card {background:#fff;border-radius:10px;box-shadow:0 2px 8px #0001;padding:0.7em 0.55em;display:flex;flex-direction:column;align-items:center;transition:box-shadow 0.14s;}
    .squad-card img {width:33px;height:33px;border-radius:7px;margin-bottom:0.6em;object-fit:contain;}
    .squad-card h3 {font-weight:800;color:#18449e;margin:0 0 0.24em 0;text-align:center;font-size:1em;}
    .squad-players {display:grid;grid-template-columns:1fr;gap:1px 6px;width:100%;}
    .squad-player {font-size:0.97em;margin:1px 0;}
    .stat-high-bar {display:flex;gap:0.6em;justify-content:center;flex-wrap:wrap;margin-bottom:1.2em;}
    .stat-high-card {background:#fff;border-radius:8px;box-shadow:0 2px 8px #0001;min-width:110px;max-width:140px;padding:0.7em 0.4em;display:flex;flex-direction:column;align-items:center;}
    .stat-high-label {color:#18449e;font-size:0.97em;font-weight:700;}
    .stat-high-main {font-size:1.25em;font-weight:800;color:#eab403;}
    .stat-high-player {font-size:0.93em;text-align:center;margin-top:0.12em;}
    .stat-high-player img {width:15px;height:15px;vertical-align:middle;margin-right:5px;border-radius:4px;}
    .team-filter-bar {text-align:center;margin-bottom:0.6em;}
    .team-filter-select {margin:0 auto 0.9em auto;padding:0.36em 0.82em;border-radius:5px;border:1px solid #d3d3d3;background:#f7f7f7;color:#21405a;font-size:1em;font-weight:600;max-width:230px;}
    #stats-search {margin-bottom:0.7rem;padding:0.35rem 0.45rem;font-size:0.97rem;width:98%;max-width:230px;border-radius:5px;border:1px solid #ccc;display:block;margin:auto;}
    @media (max-width:900px){
      .dashboard-row{flex-direction:column;gap:1.2em;}
    }
    @media (max-width:650px){
      main {padding:1.1rem 1vw 0.6rem 1vw;}
      .dashboard-row{flex-direction:column;}
      .standings-title, .group-title {font-size:1em;}
      .squad-card h3{font-size:0.97em;}
      nav .nav-main {gap:0;}
    }
    @media (max-width:600px){
      nav,nav .nav-main {flex-direction:column;}
      nav button {font-size:1.08em;padding:1em 0.6em;}
      .dashboard-navcard {min-width:80px;font-size:0.92em;}
    }
    @media (max-width:430px){
      th,td {font-size:0.84em;}
      .stat-high-card {min-width:95px;max-width:99vw;}
    }
    @media (max-width:410px){
      .dashboard-fixture-row {font-size:0.95em;}
    }
  </style>
</head>
<body>
  <header>
    <img src="logo.png" alt="Tournament Logo" />
    <h1 style="font-size:2em;">Royal Darts Premier League 2025</h1>
    <button class="hamburger" id="hamburger" aria-label="Open Navigation">
      <span></span><span></span><span></span>
    </button>
  </header>
  <nav id="navbar">
    <div class="nav-main">
      <button class="tab-button active" onclick="showTab('dashboard')">Dashboard</button>
      <button class="tab-button" onclick="showTab('fixtures')">Fixtures</button>
      <button class="tab-button" onclick="showTab('results')">Results</button>
      <button class="tab-button" onclick="showTab('standings')">Standings</button>
      <button class="tab-button" onclick="showTab('squads')">Squads</button>
      <button class="tab-button" onclick="showTab('stats')">Stats</button>
      <button class="tab-button" onclick="window.open('https://n01darts.com/n01/tournament/comp.php?id=t_NI0o_4352&tab=live','_blank')">Live</button>
    </div>
  </nav>
  <main>
    <section id="dashboard" class="section active">
      <h2 style="margin-bottom:0.7em;font-size:1.12em;">Today's Fixtures</h2>
      <div id="dashboard-fixtures"></div>
      <div class="dashboard-row" style="display:flex;gap:2.2em 3vw;flex-wrap:wrap;margin-top:1.1em;">
        <div style="flex:1;min-width:160px;max-width:430px;">
          <div class="standings-title">Group A Standings</div>
          <div id="dashboard-standingsA"></div>
        </div>
        <div style="flex:1;min-width:160px;max-width:430px;">
          <div class="standings-title">Group B Standings</div>
          <div id="dashboard-standingsB"></div>
        </div>
      </div>
      <div class="dash-high-bar" id="dashboard-highlights"></div>
      <div id="dashboard-teamday" style="margin:1.3em 0 0.9em 0;display:flex;justify-content:center;"></div>
      <div>
        <div class="latestres-title">Latest Results</div>
        <div id="dashboard-latestres"></div>
      </div>
      <div class="dashboard-navstrip">
        <button class="dashboard-navcard" onclick="showTab('fixtures')">Fixtures</button>
        <button class="dashboard-navcard" onclick="showTab('results')">Results</button>
        <button class="dashboard-navcard" onclick="showTab('standings')">Standings</button>
        <button class="dashboard-navcard" onclick="showTab('squads')">Squads</button>
        <button class="dashboard-navcard" onclick="showTab('stats')">Stats</button>
        <button class="dashboard-navcard" onclick="window.open('https://n01darts.com/n01/tournament/comp.php?id=t_NI0o_4352&tab=live','_blank')">Watch Live</button>
      </div>
    </section>
    <section id="fixtures" class="section"><div id="fixturesTableContainer"></div></section>
    <section id="results" class="section"><div id="resultsContainer"></div></section>
    <section id="standings" class="section"><div id="standingsGroupA"></div><div id="standingsGroupB"></div></section>
    <section id="squads" class="section"><div id="squadsContainer">Loading...</div></section>
    <section id="stats" class="section">
      <div id="stat-highlights"></div>
      <div class="team-filter-bar" id="team-filter-bar"></div>
      <input id="stats-search" type="text" placeholder="Search player or team..." style="margin-bottom:0.7rem;">
      <div id="stats-table"></div>
    </section>
  </main>
  <footer>
    <div class="footer-icons">
      <a href="https://n01darts.com/n01/tournament/comp.php?id=t_NI0o_4352&tab=live" target="_blank"><img src="https://n01darts.com/favicon.ico" alt="Nakka" title="Watch Live on Nakka" /></a>
      <a href="https://www.instagram.com/royaldarts_rcgc" target="_blank"><img src="https://cdn-icons-png.flaticon.com/512/174/174855.png" alt="Instagram" title="Follow us on Instagram" /></a>
    </div>
    <div class="footer-suca">Built by SUCA Analytics</div>
  </footer>
  <script>
    // NAVIGATION - Mobile hamburger
    const hamburger = document.getElementById('hamburger');
    const navbar = document.getElementById('navbar');
    hamburger.onclick = () => {
      navbar.classList.toggle('open');
      if(navbar.classList.contains('open')) document.body.style.overflow='hidden';
      else document.body.style.overflow='';
    };
    document.body.onclick = (e)=>{
      if(navbar.classList.contains('open') && !navbar.contains(e.target) && !hamburger.contains(e.target)){
        navbar.classList.remove('open');document.body.style.overflow='';
      }
    };
    // TEAM LOGOS & API
    const TEAM_LOGOS = {
      "Balaji Darts": "team_logos/Balaji-Darts.avif",
      "Biscotti Barrels": "team_logos/Biscotti-Barrels.avif",
      "BLC High Rollers": "team_logos/BLC-High-Rollers.avif",
      "Bullseye Bandits": "team_logos/Bullseye-Bandits.avif",
      "City Knights": "team_logos/City-Knights.avif",
      "Hugo & Finn": "team_logos/Hugo-&-Finn.png",
      "Keventer Eagle Eye": "team_logos/Keventer-Eagle-Eye.avif",
      "PKS Titans": "team_logos/PKS-Titans.avif",
      "Purti Forever": "team_logos/Purti-Forever.avif",
      "Rama Darts": "team_logos/Rama-Darts.png",
      "Royals Super Knights": "team_logos/Royals-Super-Knights.avif",
      "RSV Rising Stars": "team_logos/RSV-Rising-Stars.avif",
      "The Panthers": "team_logos/The-Panthers.avif",
      "Tons of Bull": "team_logos/Tons-of-Bull.avif",
      "UGW": "team_logos/UGW.png",
      "Vyana Warriors": "team_logos/Vyana-Warriors.avif"
    };
    const API_URL = 'https://script.google.com/macros/s/AKfycby6BCE5cyBaxpz-Jt-TeRH6k5Jeq-vqelr8S7rt32e7wFjBzEvuBrYi4yPaEBz2Kari/exec';

    function showTab(tabId) {
      document.querySelectorAll('.section').forEach(sec => sec.classList.remove('active'));
      document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('.dashboard-navcard').forEach(btn => btn.classList.remove('active'));
      document.getElementById(tabId).classList.add('active');
      let navBtn = Array.from(document.querySelectorAll('nav button')).find(b => b.innerText.toLowerCase() === tabId);
      if(navBtn) navBtn.classList.add('active');
      navbar.classList.remove('open');document.body.style.overflow='';
      window.scrollTo({top:0,behavior:'smooth'});
    }

    let fixturesCache = [], resultsCache = [], standingsCache = [], squadsCache = [], statsCache = [], bestLegCache = [];
    let statsSortKey = null, statsSortDir = 1, statsSearchTerm = "", teamFilter = null;
    const STATS_HIDE_COLUMNS = new Set([
      "Keep", "Break", "Second Legs", "Break Legs", "Total Score", "Total Darts", "Group", "Best Leg", "Worst Leg"
    ]);

    async function loadData() {
      try {
        const res = await fetch(API_URL);
        const data = await res.json();
        fixturesCache = data.Fixtures || [];
        resultsCache = data.Results || [];
        standingsCache = data.Standings || [];
        squadsCache = data.Squads || [];
        statsCache = (data.Stats || []).filter(row => row.Player);
        bestLegCache = (data["Best Leg"] || []).filter(row => row["Best Leg"]);
        renderDashboard();
        renderFixtures(fixturesCache);
        renderResults(resultsCache, fixturesCache);
        renderStandings(standingsCache);
        renderSquads(squadsCache);
        renderStatHighlights(statsCache, bestLegCache);
        renderStats(statsCache, bestLegCache);
        renderTeamFilter(statsCache);
      } catch (err) {console.error('Failed to load data:', err);}
    }

    // --- renderDashboard, renderDashboardFixtures, renderDashboardStandings, renderDashboardHighlights,
    // renderDashboardTeamOfDay, renderDashboardLatestResults, renderFixtures, renderResults, resultsTable, renderStandings,
    // renderSquads, renderStatHighlights (SAME as previous full solution) ---
    // For brevity, you can copy all those functions from the previous solution above.
    // Below are the changed functions for Stats tab:

    // --- STATS TAB (Mobile Optimized) ---
    function renderTeamFilter(stats) {
      const bar = document.getElementById('team-filter-bar');
      if (!stats || !stats.length) { bar.innerHTML = ''; return;}
      const allTeams = Array.from(new Set(stats.map(p => p.Team).filter(Boolean))).sort();
      let html = `<select class="team-filter-select" onchange="setTeamFilterDropdown(this)">
        <option value="">All Teams</option>`;
      allTeams.forEach(team => {
        html += `<option value="${team.replace(/"/g,'&quot;')}"${teamFilter===team?" selected":""}>${team}</option>`;
      });
      html += `</select>`;
      bar.innerHTML = html;
    }
    window.setTeamFilterDropdown = function(sel) {
      teamFilter = sel.value || null;
      renderStats(statsCache, bestLegCache);
      renderTeamFilter(statsCache);
    };
    function renderStats(stats, bestLegsSheet) {
      const searchInput = document.getElementById('stats-search');
      if (searchInput && !searchInput._listenerAdded) {
        searchInput.addEventListener("input", () => {
          statsSearchTerm = searchInput.value.trim().toLowerCase();
          renderStats(statsCache, bestLegCache);
        });
        searchInput._listenerAdded = true;
      }
      let filteredStats = stats;
      if (teamFilter) {
        filteredStats = filteredStats.filter(p => p.Team === teamFilter);
      }
      if (statsSearchTerm) {
        filteredStats = filteredStats.filter(
          p => (p.Player && p.Player.toLowerCase().includes(statsSearchTerm)) ||
               (p.Team && p.Team.toLowerCase().includes(statsSearchTerm))
        );
      }
      if (statsSortKey) {
        filteredStats = [...filteredStats].sort((a, b) => {
          let v1 = a[statsSortKey], v2 = b[statsSortKey];
          let n1 = parseFloat(v1), n2 = parseFloat(v2);
          if (!isNaN(n1) && !isNaN(n2)) {
            return statsSortDir * (n1 - n2);
          } else {
            return statsSortDir * (String(v1).localeCompare(String(v2)));
          }
        });
      }
      if (filteredStats.length) {
        const wantedHeaders = Object.keys(filteredStats[0]).filter(
          h => h && h !== "" && h !== undefined && h !== null && !STATS_HIDE_COLUMNS.has(h)
        );
        let table = "<div class='table-scroll'><table><thead><tr>";
        wantedHeaders.forEach(h => {
          let dirArrow = "";
          if (statsSortKey === h) dirArrow = statsSortDir > 0 ? " ▲" : " ▼";
          table += `<th onclick="setStatsSort('${h}')">${h}${dirArrow}</th>`;
        });
        table += "</tr></thead><tbody>";
        filteredStats.forEach(row => {
          table += "<tr>" + wantedHeaders.map(h => {
            let val = row[h] ?? "";
            if (h === "Win Rate (Sets)" || h === "Win Rate (Legs)") {
              val = isNaN(parseFloat(val)) ? "" : `${Math.round(parseFloat(val) * 100)}%`;
            }
            if (h === "Team" && TEAM_LOGOS[val]) {
              return `<td><img src="${TEAM_LOGOS[val]}" alt="${val}" style="width:13px;height:13px;border-radius:3px;vertical-align:middle;margin-right:4px;">${val}</td>`;
            }
            return `<td>${val}</td>`;
          }).join("") + "</tr>";
        });
        table += "</tbody></table></div>";
        document.getElementById("stats-table").innerHTML = table;
      } else {
        document.getElementById("stats-table").innerHTML = "<p>No player stats available.</p>";
      }
    }
    window.setStatsSort = function(h) {
      if (statsSortKey === h) {
        statsSortDir = -statsSortDir;
      } else {
        statsSortKey = h;
        statsSortDir = 1;
      }
      renderStats(statsCache, bestLegCache);
    };

    // --- Copy all other render functions from previous message as-is (for brevity not repeated here) ---
    // (renderDashboard, renderDashboardFixtures, etc...)

    loadData();
    setInterval(loadData, 60000);
    window.addEventListener('resize', function() {
      if(document.getElementById('dashboard').classList.contains('active')) renderDashboardFixtures();
    });
  </script>
</body>
</html>
