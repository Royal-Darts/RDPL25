<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Royal Darts Premier League 2025</title>
  <link rel="icon" href="https://i.postimg.cc/V6sr6vLd/temp-Image-Uig-J6-E.avif">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #1b1d2a;
      --accent: #e2b714;
      --bg: #23243b;
      --light: #fff;
      --card: #292b44;
      --grey: #b6b9c9;
      --radius: 20px;
      --navHeight: 62px;
    }
    body {
      margin: 0;
      font-family: 'Montserrat', Arial, sans-serif;
      background: var(--bg);
      color: var(--light);
      min-height: 100vh;
      padding-bottom: var(--navHeight);
    }
    header {
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--primary);
      padding: 12px 10px;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 3px 12px rgba(0,0,0,0.14);
    }
    header img {
      height: 38px;
      margin-right: 16px;
      border-radius: 50%;
      background: #222;
    }
    header h1 {
      font-size: 1.3rem;
      font-weight: 700;
      margin: 0;
      letter-spacing: 1.3px;
      color: var(--accent);
      text-shadow: 0 2px 8px #0009;
    }

    /* Navigation bar */
    nav {
      position: fixed;
      bottom: 0;
      left: 0; right: 0;
      width: 100%;
      background: var(--primary);
      border-top: 1px solid #3335;
      height: var(--navHeight);
      z-index: 200;
      display: flex;
      justify-content: space-around;
      align-items: center;
    }
    nav a {
      color: var(--grey);
      text-decoration: none;
      flex: 1;
      text-align: center;
      font-size: 0.85rem;
      padding: 4px 0;
      transition: color 0.2s;
      font-weight: 500;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    nav a.active, nav a:hover {
      color: var(--accent);
    }
    nav i {
      font-size: 1.4rem;
      margin-bottom: 2px;
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
      padding: 12px;
      padding-bottom: calc(var(--navHeight) + 12px);
    }

    .section {
      margin-bottom: 22px;
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: 0 1px 6px #0002;
      padding: 16px 10px;
    }
    .section-title {
      font-size: 1.08rem;
      font-weight: 700;
      color: var(--accent);
      margin-bottom: 10px;
      letter-spacing: 0.7px;
    }

    /* Responsive table */
    .table-wrap {
      overflow-x: auto;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 0;
      font-size: 0.96em;
      background: transparent;
    }
    th, td {
      text-align: left;
      padding: 8px 6px;
      white-space: nowrap;
    }
    th {
      background: var(--primary);
      color: var(--accent);
      font-weight: 700;
      font-size: 0.98em;
      border-bottom: 2px solid var(--accent);
    }
    tr {
      border-bottom: 1px solid #353751;
    }
    td {
      border-bottom: 1px solid #282942;
    }
    tr:last-child td {
      border-bottom: none;
    }
    /* Squads/Teams styling */
    .team-row {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .team-logo {
      width: 22px;
      height: 22px;
      object-fit: contain;
      border-radius: 100%;
      background: #fff1;
      border: 1.5px solid #3336;
    }
    /* Stats page player logos */
    .player-logo {
      width: 26px;
      height: 26px;
      object-fit: contain;
      border-radius: 50%;
      margin-right: 8px;
      background: #fff3;
      border: 1.5px solid #4447;
    }
    /* Dropdown filter */
    .stats-filter {
      width: 100%;
      padding: 7px 9px;
      font-size: 1em;
      border-radius: 7px;
      background: #242546;
      color: var(--accent);
      border: 1px solid #343665;
      margin-bottom: 15px;
      font-weight: 600;
      outline: none;
    }

    /* Stat highlights bar */
    .stats-highlights {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 12px;
      justify-content: center;
    }
    .stat-pill {
      background: #343665;
      color: var(--accent);
      font-weight: 700;
      border-radius: 16px;
      padding: 5px 12px;
      font-size: 0.94em;
      text-align: center;
      min-width: 96px;
      margin-bottom: 2px;
    }

    /* Card style for mobile */
    @media (max-width: 480px) {
      .container { padding: 7px; }
      .section { padding: 9px 2px; }
      .section-title { font-size: 1em; }
      th, td { font-size: 0.93em; padding: 6px 4px; }
      .stat-pill { min-width: 80px; font-size: 0.92em; }
      .team-logo, .player-logo { width: 18px; height: 18px; }
    }

    /* Hide scrollbars for tables on mobile */
    .table-wrap::-webkit-scrollbar { display: none; }
    .table-wrap { -ms-overflow-style: none; scrollbar-width: none; }

    /* Desktop nav style */
    @media (min-width: 700px) {
      nav {
        position: static;
        height: 54px;
        border-radius: var(--radius);
        margin: 0 auto 16px auto;
        max-width: 700px;
        box-shadow: 0 2px 10px #0001;
      }
      body { padding-bottom: 0 !important; }
    }
    /* Footer */
    footer {
      text-align: center;
      color: #b6b9c9;
      font-size: 0.93em;
      padding: 16px 0 6px 0;
      margin-top: 16px;
      letter-spacing: 0.6px;
      font-weight: 500;
    }
  </style>
  <!-- Icons CDN -->
  <link href="https://cdn.jsdelivr.net/npm/remixicon@3.6.0/fonts/remixicon.css" rel="stylesheet">
</head>
<body>
  <header>
    <img src="https://i.postimg.cc/V6sr6vLd/temp-Image-Uig-J6-E.avif" alt="Royal Darts Logo" />
    <h1>Royal Darts Premier League 2025</h1>
  </header>

  <div class="container">
    <!-- Tabs -->
    <nav>
      <a href="#dashboard" class="nav-link active"><i class="ri-dashboard-3-line"></i>Home</a>
      <a href="#fixtures" class="nav-link"><i class="ri-calendar-event-line"></i>Fixtures</a>
      <a href="#results" class="nav-link"><i class="ri-trophy-line"></i>Results</a>
      <a href="#standings" class="nav-link"><i class="ri-bar-chart-2-line"></i>Standings</a>
      <a href="#stats" class="nav-link"><i class="ri-user-star-line"></i>Stats</a>
    </nav>

    <!-- All content sections (only one visible at a time) -->
    <section id="dashboard-section" class="section"></section>
    <section id="fixtures-section" class="section" style="display:none"></section>
    <section id="results-section" class="section" style="display:none"></section>
    <section id="standings-section" class="section" style="display:none"></section>
    <section id="stats-section" class="section" style="display:none"></section>
  </div>

  <footer>
    Built by SUCA Analytics
  </footer>

  <script>
    // ============ NAVIGATION (tabs) ============
    const sections = [
      "dashboard", "fixtures", "results", "standings", "stats"
    ];
    function showSection(id) {
      sections.forEach(sec => {
        document.getElementById(sec + "-section").style.display = (sec === id) ? "block" : "none";
        document.querySelector('nav a[href="#' + sec + '"]').classList.toggle('active', sec === id);
      });
      window.scrollTo(0,0);
    }
    document.querySelectorAll('.nav-link').forEach(link => {
      link.onclick = e => {
        e.preventDefault();
        showSection(link.href.split("#")[1]);
      }
    });
    // Default tab
    showSection('dashboard');

    // ====== API ENDPOINT (Live Data) ======
    const API = "https://script.google.com/macros/s/AKfycbzjQ6yBNFFLbWfxyU-idb2j8XNTDrBj1C8kvWBSDaPirUNcU9jtNFxuI5s3CfgDMttA/exec";
    let DATA = {};

    // ====== LOADING STATES ======
    function loading(text="Loading...") {
      return `<div style="text-align:center;padding:24px 0;color:#b6b9c9;font-size:1.08em;">${text}</div>`;
    }
    sections.forEach(sec => {
      document.getElementById(sec+"-section").innerHTML = loading();
    });

    // ====== DATA FETCH + AUTO REFRESH ======
    async function fetchDataAndRender() {
      try {
        const res = await fetch(API);
        DATA = await res.json();
        renderAll();
      } catch (e) {
        sections.forEach(sec => {
          document.getElementById(sec+"-section").innerHTML = `<div style="color:red;padding:24px;text-align:center">Error loading data.<br>${e.message||e}</div>`;
        });
      }
    }
    fetchDataAndRender();
    setInterval(fetchDataAndRender, 60000);

    // ========== RENDER ALL PAGES ==========
    function renderAll() {
      renderDashboard();
      renderFixtures();
      renderResults();
      renderStandings();
      renderStats();
    }

    // ========== DASHBOARD ==========
    function renderDashboard() {
      const el = document.getElementById('dashboard-section');
      let today = new Date();
      let todayISO = today.toISOString().slice(0, 10);

      // --- Today's Fixtures ---
      let todaysFixtures = (DATA.Fixtures || []).filter(f => f.Date && f.Date.startsWith(todayISO));
      let fixturesHTML = todaysFixtures.length ? 
        `<div class="section-title">Today's Fixtures</div>
        <div class="table-wrap"><table>
        <tr><th>Time</th><th>Team 1</th><th></th><th>Team 2</th></tr>
        ${todaysFixtures.map(f =>
          `<tr>
            <td>${f.Time||'-'}</td>
            <td class="team-row">${teamLogo(f.Team1)} ${f.Team1}</td>
            <td style="color:var(--accent);text-align:center;">vs</td>
            <td class="team-row">${teamLogo(f.Team2)} ${f.Team2}</td>
          </tr>`
        ).join("")}
        </table></div>`
      : `<div style="color:var(--grey);text-align:center;font-size:1em;padding:18px 0;">No fixtures today</div>`;

      // --- Quick Standings ---
      let standings = (DATA.Standings || []).slice(0,3);
      let standingsHTML = standings.length ?
        `<div class="section-title">Quick Standings (Top 3)</div>
        <div class="table-wrap"><table>
        <tr><th>Pos</th><th>Team</th><th>Pts</th></tr>
        ${standings.map((s,i) =>
          `<tr>
            <td>${i+1}</td>
            <td class="team-row">${teamLogo(s.Team)} ${s.Team}</td>
            <td>${s.Points||'-'}</td>
          </tr>`
        ).join("")}
        </table></div>`
      : "";

      // --- Stat Highlights Bar (from Stats sheet) ---
      let stats = DATA.Stats || [];
      let highlights = [
        {label:"Best 3-Dart Avg", value: bestOf(stats,"Three Dart Avg")},
        {label:"Best First 9 Avg", value: bestOf(stats,"First 9 Avg")},
        {label:"Most Legs Won", value: mostOf(stats,"Legs Won")},
        {label:"Highest Finish", value: bestOf(stats,"Highest Finish")},
      ];
      let highlightsHTML =
        `<div class="section-title">Stat Highlights</div>
        <div class="stats-highlights">
        ${highlights.map(h =>
          `<span class="stat-pill">${h.label}<br><b>${h.value||"-"}</b></span>`
        ).join("")}
        </div>`;

      // --- Latest Results ---
      let results = (DATA.Results || []).slice(0, 4);
      let resultsHTML = results.length ?
        `<div class="section-title">Latest Results</div>
        <div class="table-wrap"><table>
        <tr><th>Date</th><th>Winner</th><th>Loser</th><th>Score</th></tr>
        ${results.map(r =>
          `<tr>
            <td>${r.Date||'-'}</td>
            <td class="team-row">${teamLogo(r.Winner)} ${r.Winner}</td>
            <td class="team-row">${teamLogo(r.Loser)} ${r.Loser}</td>
            <td>${r.Score||'-'}</td>
          </tr>`
        ).join("")}
        </table></div>`
      : "";

      // --- Featured Team (Example) ---
      let teamOfDay = (DATA.Standings || [])[0];
      let featuredHTML = teamOfDay ?
        `<div class="section-title">Team of the Day</div>
         <div class="team-row" style="font-size:1.1em;font-weight:600;justify-content:center;padding:8px 0 2px 0;">
            ${teamLogo(teamOfDay.Team,44)} ${teamOfDay.Team}
         </div>
         <div style="text-align:center;color:var(--grey);font-size:0.95em;">
           Currently top of the table!
         </div>`
      : "";

      el.innerHTML =
        fixturesHTML + standingsHTML + highlightsHTML + resultsHTML + featuredHTML;
    }

    // ========== FIXTURES ==========
    function renderFixtures() {
      const el = document.getElementById('fixtures-section');
      let fixtures = DATA.Fixtures || [];
      // Group by date
      let grouped = {};
      fixtures.forEach(f => {
        let d = f.Date || "TBD";
        if (!grouped[d]) grouped[d] = [];
        grouped[d].push(f);
      });
      let html = `<div class="section-title">Fixtures</div>`;
      for (let date in grouped) {
        html += `<div style="margin:10px 0 4px 0;font-weight:600;color:var(--accent)">${date}</div>
          <div class="table-wrap"><table>
          <tr><th>Time</th><th>Team 1</th><th></th><th>Team 2</th></tr>
          ${grouped[date].map(f =>
            `<tr>
              <td>${f.Time||'-'}</td>
              <td class="team-row">${teamLogo(f.Team1)} ${f.Team1}</td>
              <td style="color:var(--accent);text-align:center;">vs</td>
              <td class="team-row">${teamLogo(f.Team2)} ${f.Team2}</td>
            </tr>`
          ).join("")}
          </table></div>`;
      }
      el.innerHTML = html;
    }

    // ========== RESULTS ==========
    function renderResults() {
      const el = document.getElementById('results-section');
      let results = DATA.Results || [];
      // Group by date
      let grouped = {};
      results.forEach(r => {
        let d = r.Date || "TBD";
        if (!grouped[d]) grouped[d] = [];
        grouped[d].push(r);
      });
      let html = `<div class="section-title">Results</div>`;
      for (let date in grouped) {
        html += `<div style="margin:10px 0 4px 0;font-weight:600;color:var(--accent)">${date}</div>
          <div class="table-wrap"><table>
          <tr><th>Winner</th><th>Loser</th><th>Score</th></tr>
          ${grouped[date].map(r =>
            `<tr>
              <td class="team-row">${teamLogo(r.Winner)} ${r.Winner}</td>
              <td class="team-row">${teamLogo(r.Loser)} ${r.Loser}</td>
              <td>${r.Score||'-'}</td>
            </tr>`
          ).join("")}
          </table></div>`;
      }
      el.innerHTML = html;
    }

    // ========== STANDINGS ==========
    function renderStandings() {
      const el = document.getElementById('standings-section');
      let standings = DATA.Standings || [];
      // Group A/B if available
      let groupA = standings.filter(s => s.Group && s.Group === 'A');
      let groupB = standings.filter(s => s.Group && s.Group === 'B');
      let html = `<div class="section-title">Standings</div>`;

      if (groupA.length) {
        html += `<div style="margin:8px 0 2px 0;font-weight:600;color:var(--accent)">Group A</div>
        <div class="table-wrap"><table>
        <tr><th>Pos</th><th>Team</th><th>P</th><th>W</th><th>L</th><th>Pts</th></tr>
        ${groupA.map((s,i) =>
          `<tr>
            <td>${i+1}</td>
            <td class="team-row">${teamLogo(s.Team)} ${s.Team}</td>
            <td>${s.P||"-"}</td>
            <td>${s.W||"-"}</td>
            <td>${s.L||"-"}</td>
            <td>${s.Points||"-"}</td>
          </tr>`
        ).join("")}
        </table></div>`;
      }
      if (groupB.length) {
        html += `<div style="margin:12px 0 2px 0;font-weight:600;color:var(--accent)">Group B</div>
        <div class="table-wrap"><table>
        <tr><th>Pos</th><th>Team</th><th>P</th><th>W</th><th>L</th><th>Pts</th></tr>
        ${groupB.map((s,i) =>
          `<tr>
            <td>${i+1}</td>
            <td class="team-row">${teamLogo(s.Team)} ${s.Team}</td>
            <td>${s.P||"-"}</td>
            <td>${s.W||"-"}</td>
            <td>${s.L||"-"}</td>
            <td>${s.Points||"-"}</td>
          </tr>`
        ).join("")}
        </table></div>`;
      }
      if (!groupA.length && !groupB.length) {
        html += `<div style="color:var(--grey);padding:12px;text-align:center">No standings data.</div>`;
      }
      el.innerHTML = html;
    }

    // ========== STATS ==========
    function renderStats() {
      const el = document.getElementById('stats-section');
      let stats = DATA.Stats || [];
      if (!stats.length) {
        el.innerHTML = loading("No stats data.");
        return;
      }
      // Filter dropdown
      let columns = Object.keys(stats[0]).filter(k =>
        k !== "Logo" && k !== "Team"
      );
      let selected = window.localStorage.getItem('statsFilter') || columns[0];
      let filterHTML = `<select class="stats-filter" id="stats-filter">
        ${columns.map(col =>
          `<option value="${col}" ${col===selected?'selected':''}>${col}</option>`
        ).join("")}
      </select>`;
      // Table
      let tableHTML =
        `<div class="table-wrap"><table>
        <tr>
          <th>Player</th>
          <th>Team</th>
          <th>${selected}</th>
        </tr>
        ${stats.sort((a,b) =>
          (parseFloat(b[selected]) || 0) - (parseFloat(a[selected]) || 0)
        ).map(player =>
          `<tr>
            <td><span class="team-row"><img src="${player.Logo||''}" class="player-logo" alt="" />${player.Player||''}</span></td>
            <td class="team-row">${teamLogo(player.Team)} ${player.Team}</td>
            <td>${player[selected]||'-'}</td>
          </tr>`
        ).join("")}
        </table></div>`;
      el.innerHTML = `<div class="section-title">Player Statistics</div>` + filterHTML + tableHTML;

      document.getElementById('stats-filter').onchange = function() {
        window.localStorage.setItem('statsFilter', this.value);
        renderStats();
      }
    }

    // ========== TEAM LOGO HELPER ==========
    function teamLogo(name, size=22) {
      if (!name) return '';
      // Get from data, fallback to default
      let logos = DATA.TeamLogos || {};
      let url = logos[name] || "";
      if (!url) return `<span style="width:${size}px;height:${size}px;display:inline-block"></span>`;
      return `<img src="${url}" class="team-logo" style="width:${size}px;height:${size}px" alt="" />`;
    }
    // ========== HIGHLIGHTS HELPERS ==========
    function bestOf(arr, key) {
      arr = arr.filter(a => !!a[key]);
      if (!arr.length) return "-";
      let best = arr.reduce((acc,cur) =>
        (parseFloat(cur[key]) > parseFloat(acc[key])) ? cur : acc
      );
      return best[key] + (best.Player ? ` (${best.Player})` : "");
    }
    function mostOf(arr, key) {
      arr = arr.filter(a => !!a[key]);
      if (!arr.length) return "-";
      let most = arr.reduce((acc,cur) =>
        (parseFloat(cur[key]) > parseFloat(acc[key])) ? cur : acc
      );
      return most[key] + (most.Player ? ` (${most.Player})` : "");
    }
  </script>
</body>
</html>
