<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Royal Darts Premier League 2025</title>
  <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/174/174855.png" />
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f8f8f8;
    }
    header {
      background-color: #121212;
      color: #fff;
      display: flex;
      align-items: center;
      padding: 0.5rem 1rem;
      gap: 1rem;
    }
    header img {
      height: 60px;
    }
    nav {
      background: #ececec;
      display: flex;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      overflow-x: auto;
    }
    nav button {
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 0.75rem 1rem;
      cursor: pointer;
      font-weight: bold;
    }
    nav button.active {
      background: #121212;
      color: #fff;
      border-color: #000;
    }
    main {
      padding: 1rem;
    }
    .section {
      display: none;
    }
    .section.active {
      display: block;
    }
    footer {
      background: #121212;
      color: #ccc;
      padding: 1rem;
      text-align: center;
    }
    /* Tables, cards, grids, etc. (unchanged) */
    /* ... your existing CSS from index.html here ... */
  </style>
</head>
<body>
  <header>
    <img src="logo.png" alt="Tournament Logo" />
    <h1>Royal Darts Premier League 2025</h1>
  </header>

  <nav>
    <button class="tab-button active" onclick="showTab('fixtures')">Fixtures</button>
    <button class="tab-button" onclick="showTab('results')">Results</button>
    <button class="tab-button" onclick="showTab('standings')">Standings</button>
    <button class="tab-button" onclick="showTab('squads')">Squads</button>
    <button class="tab-button" onclick="showTab('stats')">Stats</button>
    <button class="tab-button" onclick="showTab('best-leg')">Best Leg</button>
  </nav>

  <main>
    <!-- Fixtures -->
    <section id="fixtures" class="section active">
      <div id="fixturesTableContainer"></div>
    </section>
    <!-- Results -->
    <section id="results" class="section">
      <div id="resultsContainer"></div>
    </section>
    <!-- Standings -->
    <section id="standings" class="section">
      <div id="standingsGroupA"></div>
      <div id="standingsGroupB"></div>
      <div class="standings-key">
        <p><strong>EF</strong> = Events For, <strong>EA</strong> = Events Against, <strong>ED</strong> = Event Difference</p>
      </div>
    </section>
    <!-- Squads -->
    <section id="squads" class="section">
      <div id="squadsContainer">Loading...</div>
    </section>
    <!-- Stats -->
    <section id="stats" class="section">
      <div id="highlights"></div>
      <div id="stats-table"></div>
    </section>
    <!-- Best Leg -->
    <section id="best-leg" class="section">
      <div id="best-leg-table"></div>
    </section>
  </main>

  <footer>
    <div class="footer-icons">
      <a href="https://n01darts.com/n01/tournament/comp.php?id=t_NI0o_4352&tab=live" target="_blank" class="icon-link">
        <img src="https://n01darts.com/favicon.ico" alt="Nakka" title="Watch Live on Nakka"
          onerror="this.style.display='none'; this.insertAdjacentHTML('afterend','<span style=\\"font-size:0.85rem;color:#ccc;padding-left:2px;\\">Nakka</span>');" />
      </a>
      <a href="https://www.instagram.com/royaldarts_rcgc" target="_blank" class="icon-link">
        <img src="https://cdn-icons-png.flaticon.com/512/174/174855.png" alt="Instagram" title="Follow us on Instagram" />
      </a>
    </div>
    <div class="footer-suca">Built by SUCA Analytics</div>
  </footer>

  <script>
    // --- LOGO MAPPING ---
    const TEAM_LOGOS = {
      "Balaji Darts": "team_logos/Balaji-Darts.avif",
      "Biscotti Barrels": "team_logos/Biscotti-Barrels.avif",
      "BLC High Rollers": "team_logos/BLC-High-Rollers.avif",
      "Bullseye Bandits": "team_logos/Bullseye-Bandits.avif",
      "City Knights": "team_logos/City-Knights.avif",
      "Hugo & Finn": "team_logos/Hugo-&-Finn.png",
      "Keventer Eagle Eye": "team_logos/Keventer-Eagle-Eye.avif",
      "PKS Titans": "team_logos/PKS-Titans.avif",
      "Purti Forever": "team_logos/Purti-Forever.avif",
      "Rama Darts": "team_logos/Rama-Darts.png",
      "Royals Super Knights": "team_logos/Royals-Super-Knights.avif",
      "RSV Rising Stars": "team_logos/RSV-Rising-Stars.avif",
      "The Panthers": "team_logos/The-Panthers.avif",
      "Tons of Bull": "team_logos/Tons-of-Bull.avif",
      "UGW": "team_logos/UGW.png",
      "Vyana Warriors": "team_logos/Vyana-Warriors.avif"
    };

    const API_URL = 'https://script.google.com/macros/s/AKfycbzjQ6yBNFFLbWfxyU-idb2j8XNTDrBj1C8kvWBSDaPirUNcU9jtNFxuI5s3CfgDMttA/exec';

    function showTab(tabId) {
      document.querySelectorAll('.section').forEach(sec => sec.classList.remove('active'));
      document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
      document.getElementById(tabId).classList.add('active');
      event.target.classList.add('active');
    }

    let fixturesCache = [];
    let statsCache = [];
    let bestLegCache = [];

    async function loadData() {
      try {
        const res = await fetch(API_URL);
        const data = await res.json();
        fixturesCache = data.Fixtures || [];
        renderFixtures(data.Fixtures);
        renderResults(data.Results, fixturesCache);
        renderStandings(data.Standings);
        renderSquads(data.Squads);

        // New: Stats
        statsCache = data.Stats || [];
        renderStats(statsCache);

        // New: Best Leg
        bestLegCache = data["Best Leg"] || [];
        renderBestLeg(bestLegCache);

      } catch (err) {
        console.error('Failed to load data:', err);
      }
    }

    // --- FIXTURES ---
    function renderFixtures(fixtures) {
      // ... your existing renderFixtures code ...
    }

    // --- RESULTS ---
    function renderResults(results, fixtures) {
      // ... your existing renderResults code ...
    }

    // --- STANDINGS ---
    function renderStandings(standings) {
      // ... your existing renderStandings code ...
    }

    // --- SQUADS ---
    function renderSquads(squads) {
      // ... your existing renderSquads code ...
    }

    // --- STATS (NEW) ---
    function renderStats(stats) {
      // Highlights grid (min 2 matches)
      const highlightsCols = [
        { key: "3 Dart Avg", label: "Best 3-Dart Avg" },
        { key: "First 9 Avg", label: "Best First 9 Avg" },
        { key: "Legs Won", label: "Most Legs Won" },
        { key: "High Finish", label: "Highest Finish" },
        { key: "Best Leg", label: "Best Leg" }
      ];
      const eligible = stats.filter(p => Number(p["Match Played"]) >= 2);
      let html = "<h2>Highlights</h2><div class='highlights-grid'>";
      highlightsCols.forEach(col => {
        const top = eligible.reduce((a, b) =>
          Number(b[col.key]) > Number(a[col.key]) ? b : a,
          eligible[0] || {}
        );
        html += `<div class='highlight-card'>
                   <strong>${col.label}</strong>
                   <p>${top.Player || "—"} (${top[col.key] || "—"})</p>
                 </div>`;
      });
      html += "</div>";
      document.getElementById("highlights").innerHTML = html;

      // Full Stats Table
      if (stats.length) {
        let table = "<table><thead><tr>" +
          Object.keys(stats[0]).map(h => `<th>${h}</th>`).join("") +
          "</tr></thead><tbody>";
        stats.forEach(row => {
          table += "<tr>" + Object.values(row).map(v => `<td>${v}</td>`).join("") + "</tr>";
        });
        table += "</tbody></table>";
        document.getElementById("stats-table").innerHTML = table;
      } else {
        document.getElementById("stats-table").innerHTML = "<p>No player stats available.</p>";
      }
    }

    // --- BEST LEG (NEW) ---
    function renderBestLeg(rows) {
      if (!rows.length) {
        document.getElementById("best-leg-table").innerHTML = "<p>No best leg data.</p>";
        return;
      }
      let tbl = "<table><thead><tr>" +
        Object.keys(rows[0]).map(h => `<th>${h}</th>`).join("") +
        "</tr></thead><tbody>";
      rows.forEach(r => {
        tbl += "<tr>" + Object.values(r).map(v => `<td>${v}</td>`).join("") + "</tr>";
      });
      tbl += "</tbody></table>";
      document.getElementById("best-leg-table").innerHTML = tbl;
    }

    // Initial load + auto-refresh every 60s
    loadData();
    setInterval(loadData, 60000);
  </script>
</body>
</html>
