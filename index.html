<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
  <title>Royal Darts Premier League 2025</title>
  <link rel="icon" href="logo.png" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lucide-static@0.322.0/font/lucide.css"/>
  <style>
    :root {
      --primary: #171e30;
      --primary2: #22355c;
      --primary-light: #e9f3ff;
      --accent: #38b6ff;
      --accent2: #ffc93a;
      --card: #fff;
      --nav-bg: #1b2a50;
      --nav-text: #e2eaf5;
      --nav-active: #ffc93a;
      --table-border: #e2ecf4;
      --wa-green: #25D366;
      --font-sans: 'Segoe UI', Arial, sans-serif;
      --font-heading: 'Segoe UI Semibold', Arial, sans-serif;
      --table-font: 0.90em;
      --min-font: 13px;
    }
    html, body {
      background: #f7fafd;
      color: #1d253c;
      font-family: var(--font-sans);
      margin: 0; padding: 0;
      min-height: 100vh;
      height: 100%;
      font-size: 14.5px;
      line-height: 1.35;
      scroll-behavior: smooth;
    }
    body {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      height: 100vh;
      background-image: linear-gradient(120deg, #e9f3ff 0%, #ffffff 100%);
      font-size: var(--min-font);
    }
    header {
      background: linear-gradient(120deg, var(--primary2) 80%, var(--accent) 120%);
      color: #fff;
      padding: 0.5rem 12px 0.45rem 12px;
      display: flex;
      align-items: center;
      gap: 0.6em;
      border-bottom: 1px solid #b2d9fc;
      box-shadow: 0 2px 8px #22355c20;
      position: sticky; top: 0; z-index: 10;
    }
    header img {
      height: 30px;
      margin-right: 0.5em;
      border-radius: 7px;
      box-shadow: 0 2px 8px #38b6ff15;
      user-select: none;
    }
    header .titlebox {
      flex: 1; min-width: 0; user-select: none;
    }
    header h1 {
      margin: 0;
      font-size: 1.07rem;
      font-weight: 800;
      color: #fff;
      letter-spacing: 0.01em;
      font-family: var(--font-heading);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      text-shadow: 0 1px 3px #22355c40;
    }
    main {
      flex: 1 0 auto;
      max-width: 530px;
      margin: 0 auto;
      width: 100%;
      padding: 10px 12px 80px 12px;
      min-height: 0;
      box-sizing: border-box;
    }
    .section { display: none; }
    .section.active { display: block; }
    .card {
      background: var(--card);
      border-radius: 14px;
      box-shadow: 0 2px 9px #c3e6ff17;
      margin-bottom: 0.85em;
      padding: 1em 0.8em;
      border: 1px solid #d8eafd;
    }
    .card h3 {
      color: var(--primary2);
      margin: 0 0 0.36em 0;
      font-weight: 800;
      font-size: 1.08em;
      font-family: var(--font-heading);
    }
    .table-scroll {
      overflow-x: auto;
      width: 100%;
      border-radius: 7px;
      margin-bottom: 0.15em;
    }
    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      font-size: var(--table-font);
    }
    th, td {
      padding: 0.5em 0.35em;
      text-align: center;
      font-size: 0.99em;
      border-bottom: 1px solid var(--table-border);
      color: #19223c;
      line-height: 1.13;
      white-space: nowrap;
    }
    th { color: var(--primary2); font-weight: 800; }
    .date-heading {
      color: var(--primary2);
      font-size: 0.98em;
      font-weight: 900;
      margin: 1em 0 0.13em 0;
      padding-bottom: 0.11em;
      border-bottom: 2.5px solid var(--accent);
      user-select: none;
    }
    .stand-row.gold .pos-cell { background: var(--accent2);}
    .stand-row.silver .pos-cell { background: #bfc9da;}
    .stand-row.elim .pos-cell { background: #f55353; color: #fff;}
    .squad-team-card {
      margin-bottom: 0.6em;
      padding: 0.48em 0.37em;
      border-radius: 10px;
      background: var(--primary-light);
      box-shadow: 0 2px 4px #38b6ff08;
    }
    .squad-team-name { font-weight: 800; font-size: 0.99em; color: var(--primary2);}
    .squad-players { display: flex; flex-wrap: wrap; gap: 6px;}
    .squad-player-name {
      background: #fff;
      padding: 0.13em 0.36em;
      border-radius: 6px;
      font-size: 0.94em;
      min-width: 67px;
      line-height: 1.08;
      cursor: pointer;
      user-select: none;
      margin-bottom: 1px;
      color: #1d253c;
      font-weight: 600;
      transition: background 0.14s;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .squad-player-name:hover, .squad-player-name:focus {
      background: var(--accent);
      color: #fff;
    }
    #stats-tip {
      font-size: 0.93em;
      color: var(--primary2);
      margin: 0.18em 0 0.5em 0;
      text-align: center;
      background: #e9f3ff;
      border-radius: 7px;
      padding: 3px 7px;
      user-select: none;
    }
    /* Modern, mobile-first Stats Table */
    .stats-table-modern {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      background: #fafdff;
      font-size: 1em;
    }
    .stats-table-modern th, .stats-table-modern td {
      padding: 0.57em 0.35em;
      text-align: left;
      border-bottom: 1px solid #e4eef7;
      font-size: 0.98em;
      vertical-align: middle;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .stats-table-modern th {
      color: #15406d;
      font-weight: 900;
      background: #e9f3ff;
      position: sticky;
      top: 0;
      z-index: 2;
      font-size: 0.99em;
    }
    .stats-table-modern tr { background: #fff;}
    .stats-table-modern tr.alt-row { background: #f5fafd;}
    .stats-table-modern .stats-best {
      background: #eaffdc !important;
      color: #227f1d !important;
      font-weight: 800;
      border-radius: 6px;
    }
    .stats-table-modern td.stats-player {
      font-weight: 900;
      color: #162f4d;
      font-size: 1.02em;
      max-width: 120px;
      cursor: pointer;
    }
    .stats-table-modern td.stats-team {
      font-weight: 600;
      color: #487eea;
      font-size: 0.96em;
      max-width: 110px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .stats-table-modern .show-more-btn {
      background: #f2f5fa;
      border: 1px solid #c2d9f8;
      border-radius: 6px;
      font-size: 0.92em;
      font-weight: 600;
      color: #2360b7;
      cursor: pointer;
      padding: 0.32em 1.0em;
      margin: 0.1em 0 0.05em 0;
      width: 99%;
    }
    .stats-table-modern .extra-stats-row td {
      background: #f8fcff;
      border-bottom: none;
      padding: 0.41em 0.7em 0.51em 0.7em;
      font-size: 0.96em;
    }
    .stats-table-modern .extra-stats-content {
      display: flex;
      flex-direction: column;
      gap: 0.28em;
      margin-top: 0.05em;
    }
    .stats-table-modern .extra-stats-label { color: #55709a; font-weight: 600; display: inline-block; width: 130px;}
    .stats-table-modern .extra-stats-value { color: #144a7b; font-weight: 700;}
    .stats-table-modern .trophy { color: #b9a019; font-size: 1.19em; vertical-align: middle;}
    .stats-table-modern .star { color: #f8ad1e; font-size: 1.1em; vertical-align: middle;}
    @media (max-width: 720px) {
      .stats-table-modern th, .stats-table-modern td { font-size: 0.93em; }
      .stats-table-modern td.stats-player { max-width: 90px; font-size: 1em;}
    }
    @media (max-width: 520px) {
      .stats-table-modern th, .stats-table-modern td { font-size: 0.91em; }
      .stats-table-modern td.stats-player { max-width: 68px; }
      .stats-table-modern .extra-stats-label { width: 85px;}
    }
    /* Stat Highlights Bar */
    .stat-high-bar {
      display: flex;
      gap: 0.8em;
      flex-wrap: wrap;
      justify-content: flex-start;
      align-items: stretch;
      margin: 0.3em 0 1em 0;
      width: 100%;
    }
    .stat-high-card {
      background: #fff;
      border: 1.5px solid #e2ecf4;
      border-radius: 10px;
      min-width: 120px;
      flex: 1 1 120px;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 0.65em 0.6em 0.72em 0.6em;
      box-shadow: 0 1px 7px #70d5ff09;
      font-size: 0.98em;
      font-weight: 700;
      user-select: none;
    }
    .stat-high-label {
      color: #388cff;
      font-weight: 700;
      font-size: 0.96em;
      margin-bottom: 0.16em;
    }
    .stat-high-main {
      color: #222;
      font-size: 1.17em;
      font-weight: 900;
      margin-bottom: 0.12em;
      letter-spacing: 0.01em;
    }
    .stat-high-player {
      font-size: 0.97em;
      color: #284f86;
      text-align: center;
      line-height: 1.11;
    }
    .stat-high-player span {
      font-size: 0.93em;
      color: #5ba1ed;
      font-weight: 600;
    }
    @media (max-width: 520px) {
      .stat-high-bar { gap: 0.3em;}
      .stat-high-card { min-width: 112px; font-size: 0.95em;}
      .stat-high-label { font-size: 0.92em;}
      .stat-high-main { font-size: 1.09em;}
    }
    /* Footer */
    footer {
      width: 100%; max-width: 530px;
      margin: 0 auto 0 auto;
      padding: 0.85em 0.7em 0.95em 0.7em;
      background: none;
      color: #7a7a7a;
      font-size: 0.88rem;
      display: flex;
      justify-content: flex-start;
      align-items: center;
      gap: 1.0rem;
      flex-shrink: 0;
      position: relative;
      user-select: none;
    }
    .footer-icons {
      display: flex; gap: 1.0rem; flex-shrink: 0;
    }
    .footer-icons img, .footer-icons .wa-btn {
      height: 22px; width: 22px; border-radius: 5px; background: #fff; border: 1px solid #bfe4fa;
      object-fit: cover; padding: 2px;
      box-shadow: 0 1px 2px #0002;
      cursor: pointer;
    }
    .wa-btn { background: var(--wa-green); color: #fff !important; border-radius: 8px; font-size: 1.12em; }
    .footer-suca { margin-left: auto; font-style: italic; color: #aaa;}
    /* Nav bar */
    .nav-bar-glass {
      position: fixed; left: 0; right: 0; bottom: 0;
      width: 100vw; max-width: 530px;
      z-index: 200; background: var(--nav-bg);
      display: flex; justify-content: space-between; align-items: center;
      border-radius: 16px 16px 0 0;
      margin: 0 auto; min-height: 50px; height: 50px;
      padding: 0 1px; font-family: var(--font-heading);
      border-top: 1px solid #30446f;
      overflow-x: auto;
      user-select: none;
    }
    .nav-bar-glass .nav-btn {
      flex: 1 1 0; background: none; border: none;
      color: var(--nav-text); font-size: 0.98em;
      min-width: 54px; max-width: 75px; padding: 0.1em 2px 0.1em 2px;
      text-align: center; cursor: pointer; display: flex;
      flex-direction: column; align-items: center; justify-content: center;
      font-weight: 700; border-radius: 10px; margin: 0 0.5px;
      transition: color 0.2s;
    }
    .nav-bar-glass .nav-btn i { font-size: 1.10em; margin-bottom: 0.03em;}
    .nav-bar-glass .nav-label {
      display: block; font-size: 0.80em; font-weight: 700;
      margin-top: -2px; opacity: 1; white-space: nowrap;
      text-shadow: 0 0 2px #000c; max-width: 62px;
      overflow: hidden; text-overflow: ellipsis;
    }
    .nav-bar-glass .nav-btn.active { color: var(--nav-active); font-weight: 800; background: #24315e9e;}
    .pad-for-nav { height: 58px; min-height: 58px; width: 100%;}
  </style>
</head>
<body>
  <header>
    <img src="logo.png" alt="Royal Darts Premier League Logo" draggable="false"/>
    <div class="titlebox"><h1>Royal Darts Premier League 2025</h1></div>
  </header>
  <main>
    <!-- DASHBOARD -->
    <section id="dashboard" class="section active" aria-label="Dashboard Home">
      <div class="card">
        <h3>Today's Fixtures</h3>
        <div class="table-scroll">
          <table class="fixtures-table" role="table" aria-live="polite" aria-atomic="true">
            <thead>
              <tr><th>Time</th><th>Team 1</th><th></th><th>Team 2</th></tr>
            </thead>
            <tbody id="dashboard-fixtures"></tbody>
          </table>
        </div>
      </div>
      <div class="card" style="margin-top:-0.6em;">
        <h3>Quick Standings</h3>
        <div class="standings-group-title" aria-hidden="true">Group A</div>
        <div class="table-scroll" role="table" aria-live="polite" aria-atomic="true">
          <table class="standings-table" role="grid">
            <thead><tr><th>Pos</th><th>Team</th><th>Pts</th></tr></thead>
            <tbody id="dashboard-standings-a"></tbody>
          </table>
        </div>
        <div class="standings-group-title" aria-hidden="true" style="margin-top:0.4em;">Group B</div>
        <div class="table-scroll" role="table" aria-live="polite" aria-atomic="true">
          <table class="standings-table" role="grid">
            <thead><tr><th>Pos</th><th>Team</th><th>Pts</th></tr></thead>
            <tbody id="dashboard-standings-b"></tbody>
          </table>
        </div>
      </div>
      <div id="home-stat-highlights"></div>
    </section>
    <!-- FIXTURES -->
    <section id="fixtures" class="section" aria-label="Fixtures">
      <div class="card"><h3>Fixtures</h3><div id="fixturesTableContainer"></div></div>
    </section>
    <!-- RESULTS -->
    <section id="results" class="section" aria-label="Results">
      <div class="card"><h3>Results</h3><div id="resultsContainer"></div></div>
    </section>
    <!-- STANDINGS -->
    <section id="standings" class="section" aria-label="Standings">
      <div class="card" style="margin-bottom:0.6em;">
        <div class="stand-legend" aria-hidden="true">
          <span class="gold" title="Gold Cup (Top 3)">Gold Cup</span>
          <span class="silver" title="Silver Cup (4-6)">Silver Cup</span>
          <span class="elim" title="Eliminated (7-8)">Eliminated</span>
        </div>
        <h3>Standings</h3>
        <div class="standings-group-title" aria-hidden="true">Group A</div>
        <div id="standings-a" role="table" aria-live="polite" aria-atomic="true"></div>
        <div class="standings-group-title" aria-hidden="true" style="margin-top:1em;">Group B</div>
        <div id="standings-b" role="table" aria-live="polite" aria-atomic="true"></div>
      </div>
    </section>
    <!-- SQUADS -->
    <section id="squads" class="section" aria-label="Squads">
      <div class="card"><h3>Squads</h3><div id="squadsContainer" class="squad-grid"></div></div>
    </section>
    <!-- STATS -->
    <section id="stats" class="section" aria-label="Player Stats">
      <div class="card">
        <h3>Player Stats</h3>
        <div id="stats-tip">Tip: Tap any player name in the table below to view and save their full player card.</div>
        <div id="stat-highlights"></div>
        <div class="team-filter-bar" id="team-filter-bar"></div>
        <input id="stats-search" type="text" placeholder="Search player or team..." aria-label="Search player or team" style="margin-bottom:0.4em;padding:0.18em 0.35em;font-size:0.93em;width:96vw;max-width:140px;border-radius:5px;border:1px solid #e2ecf4;display:block;margin:auto;">
        <div id="stats-table"></div>
      </div>
    </section>
    <!-- LIVE -->
    <section id="live" class="section" aria-label="Live Stream">
      <div class="card"><h3>Watch Live</h3><iframe src="https://n01darts.com/n01/tournament/comp.php?id=t_NI0o_4352&tab=live" width="100%" height="320" frameborder="0" style="border-radius:9px;border:none;" title="Live tournament stream"></iframe></div>
    </section>
    <!-- COMPARE -->
    <section id="compare" class="section" aria-label="Player Comparison">
      <div class="card">
        <h3>Player Comparison</h3>
        <p class="compare-instruction" id="compare-instruction" style="font-size:0.98em;margin-bottom:0.45em;">Select two or more players to compare their stats side-by-side.</p>
        <div class="player-select-container" role="group" aria-labelledby="compare-instruction"></div>
        <button id="compare-btn" class="compare-btn" disabled aria-disabled="true" aria-describedby="compare-instruction">Compare Players</button>
        <div id="compare-results" style="overflow-x:auto;"></div>
      </div>
    </section>
    <!-- TOP 10 PAGE -->
    <section id="top10" class="section" aria-label="Top 10 Players">
      <div class="card">
        <h3>Top 10 MVPs</h3>
        <div id="top10-mvp" class="table-scroll"></div>
      </div>
      <div class="card">
        <h3>Top 10 3 Dart Average</h3>
        <div id="top10-3da" class="table-scroll"></div>
      </div>
      <div class="card">
        <h3>Top 10 First 9 Dart Average</h3>
        <div id="top10-f9" class="table-scroll"></div>
      </div>
      <div class="card">
        <h3>Top 10 100+ Scores</h3>
        <div id="top10-100plus" class="table-scroll"></div>
      </div>
      <div class="card">
        <h3>Top 10 High Finish</h3>
        <div id="top10-highfinish" class="table-scroll"></div>
      </div>
    </section>
    <div class="pad-for-nav"></div>
  </main>
  <!-- NAV BAR -->
  <nav class="nav-bar-glass" role="navigation" aria-label="Main Navigation">
    <button class="nav-btn active" data-tab="dashboard" title="Home" aria-current="page"><i class="lucide lucide-home"></i><span class="nav-label">Home</span></button>
    <button class="nav-btn" data-tab="fixtures" title="Fixtures"><i class="lucide lucide-calendar-days"></i><span class="nav-label">Fixtures</span></button>
    <button class="nav-btn" data-tab="results" title="Results"><i class="lucide lucide-list-start"></i><span class="nav-label">Results</span></button>
    <button class="nav-btn" data-tab="standings" title="Standings"><i class="lucide lucide-trophy"></i><span class="nav-label">Standings</span></button>
    <button class="nav-btn" data-tab="squads" title="Squads"><i class="lucide lucide-users"></i><span class="nav-label">Squads</span></button>
    <button class="nav-btn" data-tab="stats" title="Stats"><i class="lucide lucide-bar-chart"></i><span class="nav-label">Stats</span></button>
    <button class="nav-btn" data-tab="live" title="Live"><i class="lucide lucide-play-circle"></i><span class="nav-label">Live</span></button>
    <button class="nav-btn" data-tab="compare" title="Compare Players"><i class="lucide lucide-columns"></i><span class="nav-label">Compare</span></button>
    <button class="nav-btn" data-tab="top10" title="Top 10 Players"><i class="lucide lucide-award"></i><span class="nav-label">Top 10</span></button>
  </nav>
  <footer>
    <div class="footer-icons">
      <a href="https://n01darts.com/n01/tournament/comp.php?id=t_NI0o_4352&tab=live" target="_blank" rel="noopener" aria-label="Watch live on Nakka">
        <img src="https://n01darts.com/favicon.ico" alt="Nakka" draggable="false" />
      </a>
      <a href="https://www.instagram.com/royaldarts_rcgc" target="_blank" rel="noopener" aria-label="Follow Royal Darts on Instagram">
        <img src="https://cdn-icons-png.flaticon.com/512/174/174855.png" alt="Instagram" draggable="false" />
      </a>
      <a href="#" class="wa-btn" id="wa-share-btn" title="Share on WhatsApp" aria-label="Share on WhatsApp">
        <span class="lucide lucide-message-circle" aria-hidden="true"></span>
      </a>
    </div>
    <div class="footer-suca">Built by SUCA Analytics</div>
  </footer>
  <div id="player-popup" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:250;background:rgba(34,53,92,0.92);justify-content:center;align-items:center;">
    <div class="popup-card" role="document" style="background:#fff;border-radius:8px;box-shadow:0 2px 10px #b1e1ff25;padding:0.95em 1em;color:#171e30;min-width:230px;max-width:95vw;text-align:center;font-weight:700;font-size:0.97em;position:relative;"></div>
    <button class="popup-close" onclick="hidePlayerPopup(event)" aria-label="Close player card" style="color:#222;font-size:1.2em;background:none;border:none;position:absolute;top:0.6em;right:0.8em;cursor:pointer;">&times;</button>
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" defer></script>
  <script defer>
    // ---------------------------
    // Globals & Setup
    const API_URL = 'https://script.google.com/macros/s/AKfycby6BCE5cyBaxpz-Jt-TeRH6k5Jeq-vqelr8S7rt32e7wFjBzEvuBrYi4yPaEBz2Kari/exec';
    let fixturesCache = [], standingsCache = [], statsCache = [], bestLegCache = [], squadsCache = [], resultsCache = [];
    let statsSortKey = null, statsSortDir = 1, statsSearchTerm = "", teamFilter = null;
    let compareSelections = [];
    let compareTableHtml = "";
    const STATS_HIDE_COLUMNS = new Set(["Keep", "Break", "Second Legs", "Break Legs", "Total Score", "Total Darts", "Group", "Best Leg", "Worst Leg"]);
    function showTab(tabId) {
      document.querySelectorAll('.section').forEach(sec => sec.classList.remove('active'));
      document.querySelectorAll('.nav-bar-glass .nav-btn').forEach(btn => btn.classList.remove('active'));
      const activeSection = document.getElementById(tabId);
      if (activeSection) activeSection.classList.add('active');
      document.querySelectorAll('.nav-bar-glass .nav-btn').forEach(btn => {
        if (btn.getAttribute('data-tab') === tabId) {
          btn.classList.add('active');
          btn.setAttribute('aria-current', 'page');
        } else { btn.removeAttribute('aria-current'); }
      });
      window.scrollTo({top:0,behavior:'smooth'});
    }
    function setupWhatsAppShare() {
      const waBtn = document.getElementById("wa-share-btn");
      if (waBtn) {
        waBtn.addEventListener("click", function(e) {
          e.preventDefault();
          const shareUrl = window.location.href.split('?')[0];
          const msg = encodeURIComponent("Check out the Royal Darts Premier League 2025 – live results, fixtures, stats and more! " + shareUrl);
          window.open(`https://wa.me/?text=${msg}`, "_blank");
        });
      }
    }
    async function loadData() {
      try {
        const res = await fetch(API_URL);
        const data = await res.json();
        fixturesCache = data.Fixtures || [];
        standingsCache = data.Standings || [];
        statsCache = (data.Stats || []).filter(row => row.Player);
        bestLegCache = (data["Best Leg"] || []).filter(row => row["Best Leg"]);
        squadsCache = data.Squads || [];
        resultsCache = data.Results || [];
        renderDashboardFixtures(); renderDashboardStandingsTables();
        renderFixtures(fixturesCache); renderResults(resultsCache, fixturesCache);
        renderStandingsTables(); renderSquads(squadsCache);
        renderStatHighlights(statsCache, bestLegCache, "stat-highlights");
        renderStats(statsCache, bestLegCache); renderTeamFilter(statsCache);
        renderHomeStatHighlights(statsCache, bestLegCache, "home-stat-highlights");
        renderPlayerComparisonSelectors();
        renderTop10Pages();
        if (
          document.querySelector('.nav-btn.active[data-tab="compare"]') &&
          compareTableHtml &&
          document.getElementById("compare-results")
        ) {
          document.getElementById("compare-results").innerHTML = compareTableHtml;
          const selects = document.querySelectorAll("#compare .player-select-container select");
          compareSelections.forEach((val, idx) => {
            if (selects[idx] && val) selects[idx].value = val;
          });
          updateCompareButtonState();
        }
      } catch (err) { console.error('Failed to load data:', err);}
    }

    // ... [Same renderDashboardFixtures, renderDashboardStandingsTables, quickStandingsRows, renderFixtures, renderResults, renderStandingsTables, standingsTable, renderSquads, renderStatHighlights (empty), renderTeamFilter, setTeamFilter, getBestStats are unchanged and included here for brevity] ...

    // -- Stat Highlights updated --
    function renderHomeStatHighlights(stats, bestLegsSheet, id = "home-stat-highlights") {
      const defs = [
        { key: "3 Dart Avg", label: "Best 3DA", icon: "★" },
        { key: "Win Rate (Legs)", label: "Win Rate (Legs)", icon: "🏆", minLegs: 5 },
        { key: "High Finish", label: "High Finish", icon: "🎯" },
        { key: "First 9 Avg", label: "Best F9", icon: "🚀" }
      ];
      const eligible = stats.filter(p => Number(p["Match Played"]) >= 2);
      let html = `<div class="stat-high-bar">`;
      defs.forEach(def => {
        let filtered = eligible;
        if (def.minLegs) filtered = filtered.filter(p => Number(p["Legs Played"]) >= def.minLegs);
        if (!filtered.length) return;
        const sorted = [...filtered].sort((a, b) => +b[def.key] - +a[def.key]);
        const player = sorted[0];
        let val = player[def.key] ?? "—";
        if (def.key.includes("Win Rate") && !isNaN(val)) {
          val = Math.round(val * 100) + "%";
        }
        html += `<div class="stat-high-card">
          <div class="stat-high-label">${def.icon} ${def.label}</div>
          <div class="stat-high-main">${val}</div>
          <div class="stat-high-player">
            ${player.Player}<br><span>${player.Team || ""}</span>
          </div>
        </div>`;
      });
      if (bestLegsSheet && bestLegsSheet.length) {
        let best = bestLegsSheet.sort((a, b) => Number(a["Best Leg"]) - Number(b["Best Leg"]))[0];
        html += `<div class="stat-high-card">
          <div class="stat-high-label">⏱️ Best Leg</div>
          <div class="stat-high-main">${best["Best Leg"]}</div>
          <div class="stat-high-player">
            ${best.Players} <br><span>${best.Team}</span>
          </div>
        </div>`;
      }
      html += "</div>";
      document.getElementById(id).innerHTML = html;
    }

    // -- Stats Page render --
    function renderStats(stats, bestLegsSheet) {
      const searchInput = document.getElementById('stats-search');
      if (searchInput && !searchInput._listenerAdded) {
        searchInput.addEventListener("input", () => {
          statsSearchTerm = searchInput.value.trim().toLowerCase();
          renderStats(statsCache, bestLegCache);
        });
        searchInput._listenerAdded = true;
      }
      let filteredStats = stats;
      if (teamFilter) filteredStats = filteredStats.filter(p => p.Team === teamFilter);
      if (statsSearchTerm) {
        filteredStats = filteredStats.filter(
          p => (p.Player && p.Player.toLowerCase().includes(statsSearchTerm)) ||
               (p.Team && p.Team.toLowerCase().includes(statsSearchTerm))
        );
      }
      const mainStats = ["Player", "Team", "3 Dart Avg", "Legs Won", "Match Played"];
      const extraStats = [
        "First 9 Avg", "Sets Played", "Sets Won", "Win Rate (Sets)",
        "Legs Played", "Win Rate (Legs)", "High Finish",
        "180s", "100+", "High Checkout"
      ];
      const bests = getBestStats(filteredStats, ["3 Dart Avg", "Legs Won"]);
      let html = `<table class="stats-table-modern" role="grid">
        <thead>
          <tr>
            <th>Player</th>
            <th>Team</th>
            <th title="3 Dart Average">3DA</th>
            <th title="Legs Won">Legs</th>
            <th title="Matches Played">M</th>
            <th style="text-align:center;">More</th>
          </tr>
        </thead>
        <tbody>
      `;
      filteredStats.forEach((row, i) => {
        const isAlt = i%2!==0 ? "alt-row" : "";
        const best3DA = Number(row["3 Dart Avg"]) === bests["3 Dart Avg"] && bests["3 Dart Avg"] > 0;
        const bestLegs = Number(row["Legs Won"]) === bests["Legs Won"] && bests["Legs Won"] > 0;
        html += `<tr class="${isAlt}">
          <td class="stats-player${best3DA ? ' stats-best' : ''}" onclick="showPlayerPopup('${row.Player.replace(/'/g,"\\'")}')" style="cursor:pointer;">
            ${best3DA ? '<span class="star" title="Best 3DA">★</span>':''}
            ${row.Player ? row.Player : ""}
          </td>
          <td class="stats-team">${row.Team ? row.Team : ""}</td>
          <td${best3DA ? ' class="stats-best"' : ''}>${row["3 Dart Avg"] ?? "-"}</td>
          <td${bestLegs ? ' class="stats-best"' : ''}>${bestLegs ? '<span class="trophy" title="Most Legs Won">🏆</span>' : ''}${row["Legs Won"] ?? "-"}</td>
          <td>${row["Match Played"] ?? "-"}</td>
          <td style="text-align:center;">
            <button class="show-more-btn" onclick="toggleExtraStats(this, ${i})" tabindex="0" aria-label="Show more stats for ${row.Player}">More</button>
          </td>
        </tr>
        <tr class="extra-stats-row" id="extra-stats-${i}" style="display:none;">
          <td colspan="6">
            <div class="extra-stats-content">
              ${extraStats.map(k => row[k] !== undefined && row[k] !== "" ?
                `<div><span class="extra-stats-label">${k}:</span>
                  <span class="extra-stats-value">${k.includes("Win Rate") ? (!isNaN(row[k]) ? Math.round(parseFloat(row[k])*100)+'%' : '-') : row[k]}</span>
                </div>` : ''
              ).join("")}
            </div>
          </td>
        </tr>
        `;
      });
      html += `</tbody></table>`;
      document.getElementById("stats-table").innerHTML = html;
    }
    window.toggleExtraStats = function(btn, idx) {
      const row = document.getElementById("extra-stats-"+idx);
      if (!row) return;
      if (row.style.display === "none") {
        row.style.display = "";
        btn.innerText = "Less";
      } else {
        row.style.display = "none";
        btn.innerText = "More";
      }
    };
    function showPlayerPopup(playerName) {
      let p = statsCache.find(s => s.Player === playerName);
      if (!p) return;
      let card = `<div id="player-popup-head" class="popup-head" style="font-size:1.11em;font-weight:900;">${p.Player}</div>
        <div class="popup-team" style="color:#22355c;font-size:0.99em;font-weight:700;margin-bottom:0.12em;">${p.Team||""}</div>
        <div style="color:#38b6ff;font-size:1em;font-weight:700;margin-bottom:0.2em;">Stats</div>
        ${Object.keys(p).map(h => {
          if (["Player", "Team"].includes(h) || STATS_HIDE_COLUMNS.has(h) || !p[h]) return "";
          return `<div class="popup-label" style="color:#384c7c;font-size:0.93em;margin-bottom:0.07em;"><span style="color:#38b6ff;font-weight:700;">${h}:</span> ${p[h]}</div>`;
        }).join("")}
        <button id="save-card-btn" onclick="savePlayerCard(event)" aria-label="Save player card as image" style="margin-top:0.7em;background:#38b6ff;border:none;border-radius:7px;color:#fff;font-weight:800;font-size:0.95em;padding:0.36em 0.9em;cursor:pointer;">Save Card as Image</button>`;
      document.querySelector("#player-popup .popup-card").innerHTML = card;
      const popup = document.getElementById("player-popup");
      popup.style.display = "flex";
      popup.setAttribute("aria-hidden", "false");
      popup.focus();
    }
    window.savePlayerCard = function(e) {
      e.stopPropagation();
      let cardNode = document.querySelector("#player-popup .popup-card");
      html2canvas(cardNode, {backgroundColor: "#fff", scale: 2}).then(function(canvas){
        let link = document.createElement("a");
        link.download = "Player-Card.png";
        link.href = canvas.toDataURL("image/png");
        link.click();
      });
    };
    function hidePlayerPopup(e) {
      if (!e || !e.target || e.target.id === "player-popup" || e.target.classList.contains("popup-close")) {
        const popup = document.getElementById("player-popup");
        popup.style.display = "none";
        popup.setAttribute("aria-hidden", "true");
      }
    }
    // Compare Page
    function renderPlayerComparisonSelectors() {
      const container = document.querySelector("#compare .player-select-container");
      if (!container || !statsCache.length) return;
      container.innerHTML = "";
      const NUM_SELECTS = 4;
      const uniquePlayers = Array.from(new Set(statsCache.map(p => p.Player))).sort((a,b) => a.localeCompare(b));
      for(let i=0; i<NUM_SELECTS; i++) {
        const select = document.createElement("select");
        select.setAttribute("aria-label", `Select player ${i+1}`);
        select.dataset.idx = i;
        const optionDefault = document.createElement("option");
        optionDefault.value = "";
        optionDefault.textContent = i < 2 ? `Select player ${i+1} (required)` : `Select player ${i+1} (optional)`;
        optionDefault.disabled = (i < 2);
        optionDefault.selected = true;
        select.appendChild(optionDefault);
        uniquePlayers.forEach(player => {
          const opt = document.createElement("option");
          opt.value = player;
          opt.textContent = player;
          select.appendChild(opt);
        });
        container.appendChild(select);
      }
      if (compareSelections.length) {
        setTimeout(() => {
          const selects = container.querySelectorAll("select");
          compareSelections.forEach((val, idx) => {
            if (selects[idx] && val) {
              selects[idx].value = val;
            }
          });
          updateCompareButtonState();
        }, 50);
      }
      container.querySelectorAll("select").forEach(sel => {
        sel.addEventListener("change", updateCompareButtonState);
      });
      document.getElementById("compare-results").innerHTML = compareTableHtml || "";
      updateCompareButtonState();
    }
    function updateCompareButtonState() {
      const selects = document.querySelectorAll("#compare .player-select-container select");
      const selectedValues = Array.from(selects).map(s => s.value).filter(v => v);
      const compareBtn = document.getElementById("compare-btn");
      const uniquePlayers = [...new Set(selectedValues)];
      compareBtn.disabled = uniquePlayers.length < 2;
      compareBtn.setAttribute("aria-disabled", compareBtn.disabled ? "true" : "false");
    }
    function renderPlayerComparison() {
      const selects = document.querySelectorAll("#compare .player-select-container select");
      const selectedPlayers = Array.from(selects).map(s => s.value).filter(v => v);
      const uniquePlayers = [...new Set(selectedPlayers)];
      if (uniquePlayers.length < 2) {
        alert("Please select at least two different players to compare.");
        return;
      }
      const container = document.getElementById("compare-results");
      // Reduced keys per your request:
      const keysToShow = [
        "Match Played", "Sets Played", "Sets Won", "Win Rate (Sets)",
        "Legs Played", "Legs Won", "Win Rate (Legs)",
        "3 Dart Avg", "First 9 Avg", "High Finish", "180s", "100+", "High Checkout"
      ];
      let thead = "<tr><th class='metric-header' scope='col'>Metric</th>";
      uniquePlayers.forEach(playerName => {
        thead += `<th class="player-name-cell" scope="col" title="${playerName}">${playerName}</th>`;
      });
      thead += "</tr>";
      let tbody = "";
      keysToShow.forEach(metric => {
        tbody += `<tr><th class="metric-header" scope="row">${metric}</th>`;
        uniquePlayers.forEach(playerName => {
          const playerData = statsCache.find(p => p.Player === playerName);
          let val = (playerData && (playerData[metric] !== undefined && playerData[metric] !== null && playerData[metric] !== '')) ? playerData[metric] : "0";
          if (metric.includes("Win Rate") && val !== "—") {
            val = isNaN(parseFloat(val)) ? "—" : `${Math.round(parseFloat(val)*100)}%`;
          }
          if (val === "" || val === undefined || val === null) val = "0";
          tbody += `<td>${val}</td>`;
        });
        tbody += "</tr>";
      });
      const tableHtml = `<table aria-label="Player comparison table" style="width:100%;max-width:100%;overflow-x:auto;">
        <thead>${thead}</thead>
        <tbody>${tbody}</tbody>
      </table>`;
      container.innerHTML = tableHtml;
      compareSelections = Array.from(selects).map(s => s.value);
      compareTableHtml = tableHtml;
      window.scrollTo({top:0, behavior:'smooth'});
    }
    // TOP 10 PAGE RENDER
    function renderTop10Pages() {
      if (!statsCache.length) return;
      const minMatches = 3;
      const filtered = statsCache.filter(p => Number(p["Match Played"]) >= minMatches);
      // Calculate MVP score for each player:
      filtered.forEach(p => {
        const wrl = Number(p["Win Rate (Legs)"]) || 0;
        p.mvpScore = (Number(p["3 Dart Avg"])||0)*3
          + wrl*200
          + (Number(p["High Finish"])||0)*1.2
          + (Number(p["100+"])||0)*0.7
          + (Number(p["Legs Won"])||0)*1.5
          + (Number(p["First 9 Avg"])||0)*2;
      });
      // Sort & limit
      const topMVP = [...filtered].sort((a,b)=>b.mvpScore - a.mvpScore).slice(0,10);
      const top3DA = [...filtered].sort((a,b)=>b["3 Dart Avg"]-a["3 Dart Avg"]).slice(0,10);
      const topF9 = [...filtered].sort((a,b)=>b["First 9 Avg"]-a["First 9 Avg"]).slice(0,10);
      const top100 = [...filtered].sort((a,b)=>b["100+"]-a["100+"]).slice(0,10);
      const topHighFinish = [...filtered].sort((a,b)=>b["High Finish"]-a["High Finish"]).slice(0,10);

      document.getElementById("top10-mvp").innerHTML = renderSimpleTable(topMVP, ["Player","Team","mvpScore"], ["Player","Team","MVP Score"]);
      document.getElementById("top10-3da").innerHTML = renderSimpleTable(top3DA, ["Player","Team","3 Dart Avg"], ["Player","Team","3DA"]);
      document.getElementById("top10-f9").innerHTML = renderSimpleTable(topF9, ["Player","Team","First 9 Avg"], ["Player","Team","First 9 Avg"]);
      document.getElementById("top10-100plus").innerHTML = renderSimpleTable(top100, ["Player","Team","100+"], ["Player","Team","100+"]);
      document.getElementById("top10-highfinish").innerHTML = renderSimpleTable(topHighFinish, ["Player","Team","High Finish"], ["Player","Team","High Finish"]);
    }
    function renderSimpleTable(data, keys, headers) {
      let html = '<div class="table-scroll"><table><thead><tr>';
      headers.forEach(h => html += `<th>${h}</th>`);
      html += '</tr></thead><tbody>';
      data.forEach(row => {
        html += '<tr>';
        keys.forEach(k => {
          let val = row[k];
          if(k==="mvpScore") val = val.toFixed(1);
          html += `<td style="text-align:center;">${val ?? "-"}</td>`;
        });
        html += '</tr>';
      });
      html += '</tbody></table></div>';
      return html;
    }
    // Save Player Card & Popup functions (unchanged)
    window.toggleExtraStats = function(btn, idx) {
      const row = document.getElementById("extra-stats-"+idx);
      if (!row) return;
      if (row.style.display === "none") {
        row.style.display = "";
        btn.innerText = "Less";
      } else {
        row.style.display = "none";
        btn.innerText = "More";
      }
    };
    window.savePlayerCard = function(e) {
      e.stopPropagation();
      let cardNode = document.querySelector("#player-popup .popup-card");
      html2canvas(cardNode, {backgroundColor: "#fff", scale: 2}).then(function(canvas){
        let link = document.createElement("a");
        link.download = "Player-Card.png";
        link.href = canvas.toDataURL("image/png");
        link.click();
      });
    };
    function hidePlayerPopup(e) {
      if (!e || !e.target || e.target.id === "player-popup" || e.target.classList.contains("popup-close")) {
        const popup = document.getElementById("player-popup");
        popup.style.display = "none";
        popup.setAttribute("aria-hidden", "true");
      }
    }
    // Initial DOM & Event listeners
    document.addEventListener("DOMContentLoaded", function() {
      document.querySelectorAll('.nav-bar-glass .nav-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const tab = this.getAttribute('data-tab');
          showTab(tab);
        });
      });
      setupWhatsAppShare();
      document.getElementById("compare-btn").addEventListener("click", renderPlayerComparison);
      loadData();
      setInterval(loadData, 60000);
    });
  </script>
</body>
</html>
