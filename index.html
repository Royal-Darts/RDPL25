<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
  <title>Royal Darts Premier League 2025</title>
  <!-- Social preview meta for WhatsApp & co -->
  <meta property="og:title" content="Royal Darts Premier League 2025" />
  <meta property="og:description" content="Live results, fixtures, standings, and stats for the Royal Darts Premier League." />
  <meta property="og:image" content="logo.png" />
  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="twitter:title" content="Royal Darts Premier League 2025"/>
  <meta name="twitter:description" content="Live results, fixtures, standings, and stats for India's premier darts league."/>
  <meta name="twitter:image" content="logo.png"/>
  <link rel="icon" href="logo.png" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lucide-static@0.322.0/font/lucide.css"/>
  <meta name="theme-color" content="#171e30">
  <style>
    :root {
      --primary: #171e30;
      --primary2: #22355c;
      --primary-light: #e9f3ff;
      --accent: #38b6ff;
      --accent2: #ffc93a;
      --gold: #ffc93a;
      --silver: #bfc9da;
      --eliminated: #f55353;
      --card: #fff;
      --glass-bg: rgba(255,255,255,0.23);
      --glass-border: rgba(56,182,255,0.10);
      --nav-bg: rgba(23,30,48,0.85);
      --nav-glass: rgba(34,53,92,0.72);
      --shadow: 0 4px 32px 0 rgba(56,182,255,0.14);
      --table-border: #e2ecf4;
      --text: #1d253c;
      --wa-green: #25D366;
    }
    html, body {
      background: #f7fafd;
      color: var(--text);
      font-family: 'Segoe UI', Arial, sans-serif;
      margin: 0; padding: 0; min-height: 100%;
    }
    header {
      background: linear-gradient(120deg, var(--primary2) 80%, var(--accent) 120%);
      color: #fff;
      padding: 1.08rem 0.5rem 1.08rem 0.5rem;
      text-align: left;
      display: flex; align-items: center; gap: 0.8em;
      border-bottom: 1.5px solid #b2d9fc;
      box-shadow: 0 3px 30px #22355c0b;
    }
    header img { height: 44px; margin-right: 0.65em; border-radius: 9px; box-shadow: 0 2px 8px #38b6ff11; }
    header .titlebox { flex:1;}
    header h1 {margin: 0; font-size: 1.15em; font-weight: 800; color: #fff; line-height: 1.09;}
    main { max-width: 540px; margin: 0 auto 88px auto; padding: 1rem 0.14rem 0.1rem 0.14rem; }
    .section { display: none; }
    .section.active { display: block; }
    .card {
      background: var(--card);
      border-radius: 18px;
      box-shadow: 0 4px 28px #c3e6ff17;
      margin-bottom: 1.19em;
      padding: 1.09em 0.85em 1.05em 0.85em;
    }
    .card h3 {
      color: var(--primary2); margin: 0 0 0.32em 0;
      font-weight: 900; font-size:1.08em; letter-spacing:0.01em;
    }
    .table-scroll {
      overflow-x: auto;
      width: 100%;
      border-radius: 12px;
      margin-bottom: 0.25em;
    }
    table {
      width: 100%; background: transparent;
      border-collapse: separate; border-spacing: 0; margin: 0;
      font-size: 1em; border: none;
    }
    th,td {
      padding: 0.61em 0.25em;
      text-align: center;
      font-size: 1.08em;
      border-bottom: 1px solid var(--table-border);
      background: transparent;
      color: var(--text);
      word-break: break-word; white-space: pre-line; overflow-wrap: anywhere; line-height: 1.18;
    }
    th { color: var(--primary2); font-weight:800; background:transparent; border-bottom:2px solid #b2d9fc;}
    .curl { white-space: pre-line; word-break: break-word; }
    .stand-row {
      background: #fff; border-radius: 8px; font-weight: 700;
      font-size: 1.08em; margin-bottom: 0.10em; position:relative; box-shadow: 0 2px 14px #38b6ff09; text-align: center;
      border-left: 7px solid transparent; transition:box-shadow 0.12s;
    }
    .stand-row.gold {border-left: 7px solid var(--gold);}
    .stand-row.silver {border-left: 7px solid var(--silver);}
    .stand-row.elim {border-left: 7px solid var(--eliminated);}
    .stand-teamlogo { width: 20px; height: 20px; border-radius: 4px; vertical-align: middle; margin-right: 7px;}
    .stand-points {font-weight:800; font-size:1.03em;}
    .stand-legend {text-align:center;font-size:0.98em;margin-bottom:0.7em;}
    .stand-legend span {display:inline-block;border-radius:4px;padding:2px 9px;margin:0 5px;font-weight:700;}
    .stand-legend .gold {background:var(--gold);color:#2e2e2e;}
    .stand-legend .silver {background:var(--silver);color:#232323;}
    .stand-legend .elim {background:#ffdbdb;color:#99111c;}
    .cup-badge {font-size:0.95em; font-weight:700; border-radius:6px; padding:2px 9px; display:inline-block;}
    .cup-gold {background:var(--gold);color:#2e2e2e;}
    .cup-silver {background:var(--silver);color:#232323;}
    .cup-elim {background:#e6e6e6;color:#b4312a;}
    .date-heading { color: var(--primary2); font-size: 1.22em; font-weight: 900; margin: 1.3em 0 0.12em 0; padding-bottom: 0.14em; border-bottom: 3.5px solid var(--accent); letter-spacing: 0.01em;}
    /* ... (rest of your CSS is unchanged, or paste from previous versions if you have custom squads/stats styling) ... */
    @media (max-width:540px) {
      main {padding:0.62rem 0.01rem 3.6rem 0.01rem;}
      header img {height:22px;}
      .card {padding:0.52em 0.09em;}
      .date-heading {font-size: 1em;}
      .nav-glass-pill {padding: 0.07em 0 0.07em 0;}
      .nav-glass-pill .nav-label { font-size:0.76em; }
      th,td {font-size:0.95em;}
      table {font-size:0.97em;}
    }
  </style>
</head>
<body>
  <header>
    <img src="logo.png" alt="Logo"/>
    <div class="titlebox">
      <h1>Royal Darts Premier League 2025</h1>
    </div>
  </header>
  <main>
    <!-- DASHBOARD -->
    <section id="dashboard" class="section active">
      <div class="card">
        <h3>Today's Fixtures</h3>
        <div class="table-scroll">
          <table class="fixtures-table" id="dashboard-fixtures-table">
            <thead>
              <tr>
                <th>Time</th>
                <th>Team 1</th>
                <th></th>
                <th>Team 2</th>
              </tr>
            </thead>
            <tbody id="dashboard-fixtures"></tbody>
          </table>
        </div>
      </div>
      <div class="card" style="margin-top:-0.7em;">
        <h3>Quick Standings</h3>
        <div class="standings-group-title">Group A</div>
        <div class="table-scroll"><table class="standings-table"><thead>
          <tr><th>Pos</th><th>Team</th><th>Pts</th></tr>
        </thead><tbody id="dashboard-standings-a"></tbody></table></div>
        <div class="standings-group-title">Group B</div>
        <div class="table-scroll"><table class="standings-table"><thead>
          <tr><th>Pos</th><th>Team</th><th>Pts</th></tr>
        </thead><tbody id="dashboard-standings-b"></tbody></table></div>
      </div>
    </section>
    <!-- FIXTURES -->
    <section id="fixtures" class="section"><div class="card"><h3>Fixtures</h3><div id="fixturesTableContainer"></div></div></section>
    <!-- RESULTS -->
    <section id="results" class="section"><div class="card"><h3>Results</h3><div id="resultsContainer"></div></div></section>
    <!-- STANDINGS -->
    <section id="standings" class="section">
      <div class="card" style="margin-bottom:0.8em;">
        <div class="stand-legend">
          <span class="gold"><i class="lucide lucide-trophy" style="font-size:1.09em;vertical-align:middle;margin-right:3px;"></i>Gold Cup (Top 3)</span>
          <span class="silver"><i class="lucide lucide-award" style="font-size:1.05em;vertical-align:middle;margin-right:3px;"></i>Silver Cup (4-6)</span>
          <span class="elim"><i class="lucide lucide-x-circle" style="font-size:1.03em;vertical-align:middle;margin-right:3px;"></i>Eliminated (7-8)</span>
          <span style="margin-left:8px;">EF = Events For, EA = Events Against, ED = Events Diff</span>
        </div>
        <h3>Standings</h3>
        <div class="standings-group-title">Group A</div>
        <div id="standings-a"></div>
        <div class="standings-group-title" style="margin-top:1.2em;">Group B</div>
        <div id="standings-b"></div>
      </div>
    </section>
    <!-- SQUADS -->
    <section id="squads" class="section">
      <div class="card">
        <h3>Squads</h3>
        <div id="squadsContainer" class="squad-grid"></div>
      </div>
    </section>
    <!-- STATS -->
    <section id="stats" class="section">
      <div class="card"><h3>Player Stats</h3>
        <div id="stats-tip">Tip: Tap any player name in the table below to view and save their full player card.</div>
        <div id="stat-highlights"></div>
        <div class="team-filter-bar" id="team-filter-bar"></div>
        <input id="stats-search" type="text" placeholder="Search player or team..." style="margin-bottom:0.8em;padding:0.33em 0.49em;font-size:0.96em;width:98vw;max-width:210px;border-radius:5px;border:1px solid #e2ecf4;display:block;margin:auto;">
        <div id="stats-table"></div>
      </div>
    </section>
    <!-- LIVE -->
    <section id="live" class="section">
      <div class="card">
        <h3>Watch Live</h3>
        <iframe src="https://n01darts.com/n01/tournament/comp.php?id=t_NI0o_4352&tab=live" width="100%" height="420" frameborder="0" style="border-radius:12px;border:none;"></iframe>
      </div>
    </section>
  </main>
  <div class="nav-glass-pill">
    <button class="nav-item active" onclick="showTab('dashboard')" title="Home"><span class="nav-icon lucide lucide-home"></span><span class="nav-label">Home</span></button>
    <button class="nav-item" onclick="showTab('fixtures')" title="Fixtures"><span class="nav-icon lucide lucide-calendar-days"></span><span class="nav-label">Fixtures</span></button>
    <button class="nav-item" onclick="showTab('results')" title="Results"><span class="nav-icon lucide lucide-list-start"></span><span class="nav-label">Results</span></button>
    <button class="nav-item" onclick="showTab('standings')" title="Standings"><span class="nav-icon lucide lucide-trophy"></span><span class="nav-label">Standings</span></button>
    <button class="nav-item" onclick="showTab('squads')" title="Squads"><span class="nav-icon lucide lucide-users"></span><span class="nav-label">Squads</span></button>
    <button class="nav-item" onclick="showTab('stats')" title="Stats"><span class="nav-icon lucide lucide-bar-chart"></span><span class="nav-label">Stats</span></button>
    <button class="nav-item" onclick="showTab('live')" title="Live"><span class="nav-icon lucide lucide-play-circle"></span><span class="nav-label">Live</span></button>
  </div>
  <!-- Player popup -->
  <div id="player-popup" onclick="hidePlayerPopup(event)">
    <div class="popup-card"></div>
    <button class="popup-close" onclick="hidePlayerPopup(event)">&times;</button>
  </div>
  <footer style="margin-bottom:80px">
    <div class="footer-icons">
      <a href="https://n01darts.com/n01/tournament/comp.php?id=t_NI0o_4352&tab=live" target="_blank"><img src="https://n01darts.com/favicon.ico" alt="Nakka" title="Watch Live on Nakka" /></a>
      <a href="https://www.instagram.com/royaldarts_rcgc" target="_blank"><img src="https://cdn-icons-png.flaticon.com/512/174/174855.png" alt="Instagram" title="Follow us on Instagram" /></a>
      <a href="#" class="wa-btn" id="wa-share-btn" title="Share on WhatsApp">
        <span class="lucide lucide-message-circle"></span>Share
      </a>
    </div>
    <div class="footer-suca">Built by SUCA Analytics</div>
  </footer>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script>
    // TEAM LOGOS, API URL
    const TEAM_LOGOS = {
      "Balaji Darts": "team_logos/Balaji-Darts.avif",
      "Biscotti Barrels": "team_logos/Biscotti-Barrels.avif",
      "BLC High Rollers": "team_logos/BLC-High-Rollers.avif",
      "Bullseye Bandits": "team_logos/Bullseye-Bandits.avif",
      "City Knights": "team_logos/City-Knights.avif",
      "Hugo & Finn": "team_logos/Hugo-&-Finn.png",
      "Keventer Eagle Eye": "team_logos/Keventer-Eagle-Eye.avif",
      "PKS Titans": "team_logos/PKS-Titans.avif",
      "Purti Forever": "team_logos/Purti-Forever.avif",
      "Rama Darts": "team_logos/Rama-Darts.png",
      "Royals Super Knights": "team_logos/Royals-Super-Knights.avif",
      "RSV Rising Stars": "team_logos/RSV-Rising-Stars.avif",
      "The Panthers": "team_logos/The-Panthers.avif",
      "Tons of Bull": "team_logos/Tons-of-Bull.avif",
      "UGW": "team_logos/UGW.png",
      "Vyana Warriors": "team_logos/Vyana-Warriors.avif"
    };
    const API_URL = 'https://script.google.com/macros/s/AKfycby6BCE5cyBaxpz-Jt-TeRH6k5Jeq-vqelr8S7rt32e7wFjBzEvuBrYi4yPaEBz2Kari/exec';

    function showTab(tabId) {
      document.querySelectorAll('.section').forEach(sec => sec.classList.remove('active'));
      document.querySelectorAll('.nav-item').forEach(btn => btn.classList.remove('active'));
      document.getElementById(tabId).classList.add('active');
      let navBtns = Array.from(document.querySelectorAll('.nav-glass-pill .nav-item'));
      navBtns.forEach(btn => {
        if(btn.innerText.toLowerCase().includes(tabId)) btn.classList.add('active');
      });
      window.scrollTo({top:0,behavior:'smooth'});
    }

    document.addEventListener("DOMContentLoaded", function() {
      const waBtn = document.getElementById("wa-share-btn");
      if(waBtn) {
        waBtn.addEventListener("click", function(e){
          e.preventDefault();
          const shareUrl = window.location.href.split('?')[0];
          const msg = encodeURIComponent("Check out the Royal Darts Premier League 2025 – live results, fixtures, stats and more! " + shareUrl);
          window.open(`https://wa.me/?text=${msg}`,"_blank");
        });
      }
    });

    let fixturesCache = [], standingsCache = [], statsCache = [], bestLegCache = [], squadsCache = [], resultsCache = [];
    let statsSortKey = null, statsSortDir = 1, statsSearchTerm = "", teamFilter = null;
    const STATS_HIDE_COLUMNS = new Set([
      "Keep", "Break", "Second Legs", "Break Legs", "Total Score", "Total Darts", "Group", "Best Leg", "Worst Leg"
    ]);

    async function loadData() {
      try {
        const res = await fetch(API_URL);
        const data = await res.json();
        fixturesCache = data.Fixtures || [];
        standingsCache = data.Standings || [];
        statsCache = (data.Stats || []).filter(row => row.Player);
        bestLegCache = (data["Best Leg"] || []).filter(row => row["Best Leg"]);
        squadsCache = data.Squads || [];
        resultsCache = data.Results || [];
        renderDashboardFixtures();
        renderDashboardStandingsTables();
        renderFixtures(fixturesCache);
        renderResults(resultsCache, fixturesCache);
        renderStandingsTables();
        renderSquads(squadsCache);
        renderStatHighlights(statsCache, bestLegCache, "stat-highlights");
        renderStats(statsCache, bestLegCache);
        renderTeamFilter(statsCache);
      } catch (err) {console.error('Failed to load data:', err);}
    }

    // Today’s Fixtures, IST only
    function renderDashboardFixtures() {
      const now = new Date();
      const istNow = new Date(now.toLocaleString("en-US", {timeZone: "Asia/Kolkata"}));
      const istYear = istNow.getFullYear(), istMonth = istNow.getMonth(), istDate = istNow.getDate();
      function isISTToday(d) {
        const istD = new Date(new Date(d).toLocaleString("en-US", {timeZone: "Asia/Kolkata"}));
        return (istD.getFullYear() === istYear && istD.getMonth() === istMonth && istD.getDate() === istDate);
      }
      const todaysFixtures = fixturesCache.filter(fix => isISTToday(fix.Date));
      let html = '';
      if (!todaysFixtures.length) {
        html = `<tr><td colspan="4" style="color:var(--primary);">No fixtures today.</td></tr>`;
      } else {
        todaysFixtures.forEach(f => {
          const timeStr = new Date(f.Time).toLocaleTimeString('en-IN',{hour:'2-digit',minute:'2-digit',hour12:true,timeZone:'Asia/Kolkata'});
          html += `<tr>
            <td>${timeStr}</td>
            <td class="curl">${curlText(f['Team 1']) || ""}</td>
            <td></td>
            <td class="curl">${curlText(f['Team 2']) || ""}</td>
          </tr>`;
        });
      }
      document.getElementById('dashboard-fixtures').innerHTML = html;
    }
    function renderDashboardStandingsTables() {
      const A = standingsCache.filter(s => s.Group?.toUpperCase() === 'A').sort((a,b)=>b.Points-a.Points || b.LD-a.LD);
      const B = standingsCache.filter(s => s.Group?.toUpperCase() === 'B').sort((a,b)=>b.Points-a.Points || b.LD-a.LD);
      document.getElementById('dashboard-standings-a').innerHTML = quickStandingsRows(A);
      document.getElementById('dashboard-standings-b').innerHTML = quickStandingsRows(B);
    }
    function quickStandingsRows(arr) {
      return arr.map((s,i) => {
        let groupClass = i < 3 ? "gold" : i < 6 ? "silver" : "elim";
        return `<tr class="stand-row ${groupClass}">
          <td>${i+1}</td>
          <td class="curl" style="text-align:center;"><img class="stand-teamlogo" src="${TEAM_LOGOS[s.Team]||''}" alt="">${curlText(s.Team)}</td>
          <td class="stand-points" style="text-align:center;">${s.Points}</td>
        </tr>`;
      }).join('');
    }
    function renderFixtures(fixtures) {
      const container = document.getElementById('fixturesTableContainer');
      if (!fixtures.length) {
        container.innerHTML = '<div class="table-scroll"><table><tbody><tr><td>Loading...</td></tr></tbody></table></div>';
        return;
      }
      const byDate = {};
      fixtures.forEach(f => {
        const d = new Date(f.Date).toDateString();
        if (!byDate[d]) byDate[d] = [];
        byDate[d].push(f);
      });
      let html = '';
      Object.keys(byDate).sort((a, b) => new Date(a) - new Date(b)).forEach(dateStr => {
        html += `<div class="date-heading">${dateStr}</div>
        <div class="table-scroll">
        <table class="fixtures-table">
          <thead>
            <tr><th>Time</th><th>Team 1</th><th></th><th>Team 2</th></tr>
          </thead>
          <tbody>`;
        byDate[dateStr].forEach(f => {
          html += `<tr>
              <td>${new Date(f.Time).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</td>
              <td class="curl">${curlText(f['Team 1'] || "")}</td>
              <td></td>
              <td class="curl">${curlText(f['Team 2'] || "")}</td>
            </tr>`;
        });
        html += `</tbody></table></div>`;
      });
      container.innerHTML = html;
    }
    function renderResults(results, fixtures) {
      // ... (add your results rendering logic here from previous code)
    }
    function renderStandingsTables() {
      const A = standingsCache.filter(s => s.Group?.toUpperCase() === 'A').sort((a,b)=>b.Points-a.Points || b.LD-a.LD);
      const B = standingsCache.filter(s => s.Group?.toUpperCase() === 'B').sort((a,b)=>b.Points-a.Points || b.LD-a.LD);
      document.getElementById('standings-a').innerHTML = standingsTable(A);
      document.getElementById('standings-b').innerHTML = standingsTable(B);
    }
    function standingsTable(arr) {
      let html = `<div class="table-scroll"><table class="standings-table"><thead>
        <tr>
          <th>Pos</th>
          <th>Team</th>
          <th>P</th>
          <th>W</th>
          <th>L</th>
          <th>EF</th>
          <th>EA</th>
          <th>ED</th>
          <th>Pts</th>
          <th>Avg</th>
          <th>Cup</th>
        </tr>
      </thead><tbody>`;
      arr.forEach((s,i) => {
        let cup, cupClass;
        if (i < 3) {cup = "🏆 Gold"; cupClass = "cup-badge cup-gold";}
        else if (i < 6) {cup = "🥈 Silver"; cupClass = "cup-badge cup-silver";}
        else {cup = "🚫 Out"; cupClass = "cup-badge cup-elim";}
        let groupClass = i < 3 ? "gold" : i < 6 ? "silver" : "elim";
        html += `<tr class="stand-row ${groupClass}">
          <td>${i+1}</td>
          <td class="curl" style="text-align:center;"><img class="stand-teamlogo" src="${TEAM_LOGOS[s.Team]||''}" alt="">${curlText(s.Team)}</td>
          <td style="text-align:center;">${s.P}</td>
          <td style="text-align:center;">${s.W}</td>
          <td style="text-align:center;">${s.L}</td>
          <td style="text-align:center;">${s.LF||0}</td>
          <td style="text-align:center;">${s.LA||0}</td>
          <td style="text-align:center;">${s.LD||0}</td>
          <td class="stand-points" style="text-align:center;">${s.Points}</td>
          <td style="text-align:center;">${s.Avg}</td>
          <td style="text-align:center;"><span class="${cupClass}">${cup}</span></td>
        </tr>`;
      });
      html += "</tbody></table></div>";
      return html;
    }
    function renderSquads(squads) {
      // ... (paste your squads render logic from previous code)
    }
    function renderStatHighlights(stats, bestLegsSheet, id="stat-highlights") {
      // ... (paste your stats highlight logic from previous code)
    }
    function renderTeamFilter(stats) {
      // ... (paste your team filter logic from previous code)
    }
    function renderStats(stats, bestLegsSheet) {
      // ... (paste your stats table logic from previous code)
    }
    // Utility
    function curlText(txt) {
      if (!txt) return '';
      let parts = txt.split(" ");
      if (parts.length <= 1) return txt;
      let mid = Math.ceil(parts.length/2);
      return parts.slice(0,mid).join(" ")+"\n"+parts.slice(mid).join(" ");
    }
    // Player popup (add your full player card popup logic from before here)
    function hidePlayerPopup(e) {
      if (!e || !e.target || e.target.id === "player-popup" || e.target.classList.contains("popup-close"))
        document.getElementById("player-popup").style.display = "none";
    }
    loadData();
    setInterval(loadData, 60000);
  </script>
</body>
</html>
